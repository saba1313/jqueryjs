<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
		<title>Interface connect</title>
		<script type="text/javascript" src="../../../trunk/jquery/src/jquery/jquery.js"></script>
		<script type="text/javascript" src="../../../trunk/jquery/src/selector/selector.js"></script>
		<script type="text/javascript" src="../../../trunk/jquery/src/event/event.js"></script>
		<script type="text/javascript" src="../../../trunk/jquery/src/fx/fx.js"></script>
		<script type="text/javascript" src="../../../trunk/jquery/src/ajax/ajax.js"></script>
		<script type="text/javascript" src="../../../trunk/plugins/dimensions/dimensions.js"></script>
		<script type="text/javascript" src="../draggables/draggables.js"></script>
		<style type="text/css">
			canvas {
				background: transparent;
			}
		</style>
		<script type="text/javascript">
		$(document).ready(function() {
			
			$("#draggable").drag({
				wrapHelper: false,
				helper: function(drag) {
					var newLine = document.createElement("canvas");
					return newLine;
				},
				onDrag: function(helper,position,oldPosition,cursorAt) {
					
					var relX = (position[0] - oldPosition[0]);
					var relY = (position[1] - oldPosition[1]);
					
					$(helper).attr("width", Math.abs(relX));
					$(helper).attr("height", Math.abs(relY));
					
					if(relY < 0) {
						var newY = oldPosition[1]+cursorAt.top-Math.abs(relY);
						var offY = Math.abs(relY);
						relY = 0;	
					} else {
						var offY = 0;
					}
					if(relX < 0) {
						var newX = oldPosition[0]+cursorAt.left-Math.abs(relX);
						var offX = Math.abs(relX);
						relX = 0;	
					} else {
						var offX = 0;
					}

					var ctx = helper.getContext('2d');
					ctx.clearRect(0,0,helper.offsetWidth,helper.offsetHeight);

					ctx.beginPath();					
					ctx.moveTo(offX,offY);					
					ctx.lineTo(relX,relY);
					ctx.closePath();
					ctx.stroke();				

					return { x: (newX || oldPosition[0]+cursorAt.left), y: (newY || oldPosition[1]+cursorAt.top) };
				}
			});
			
			$(".droppable").drop({
				accept: "draggable",
				onHover: function() {
					this.style.border = "2px solid red;";
				},
				onOut: function() {
					this.style.border = "1px solid black;";
				},
				onDrop: function(drag,helper) {
					var newLine = $(helper).clone();
					//$("body").append(newLine);
					
					//get the offsets of both elements
					var dropOffset = $(this).offset({ border: false });
					var dragOffset = $(drag).offset({ border: false });
					
					//Now we need to connect sense making edges based on the offset position
					
					this.style.border = "1px solid black;";
				}
			});
						
		});
		</script>
	</head>
	<body>
		<div id="draggable" class="draggable" style="border: 1px solid black; width: 300px; position: absolute; top: 10px; left: 300px;">I'm a draggable.</div>
		<div class="droppable" style="border: 1px solid black; width: 300px; height: 100px; position: absolute; top: 300px; left: 600px;">I'm a drop target.</div>
		<div class="droppable" style="border: 1px solid black; width: 300px; height: 100px; position: absolute; top: 300px; left: 100px;">I'm another drop target.</div>
	</body>
</html>
