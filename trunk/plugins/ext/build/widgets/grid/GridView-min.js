/*
 * Ext - JS Library 1.0 Alpha 2
 * Copyright(c) 2006-2007, Jack Slocum.
 * 
 * http://www.extjs.com/license.txt
 */

Ext.grid.GridView=function(_1){Ext.grid.GridView.superclass.constructor.call(this);this.el=null;Ext.apply(this,_1);};Ext.extend(Ext.grid.GridView,Ext.grid.AbstractGridView,{rowClass:"x-grid-row",cellClass:"x-grid-col",tdClass:"x-grid-td",hdClass:"x-grid-hd",splitClass:"x-grid-split",sortClasses:["sort-asc","sort-desc"],enableMoveAnim:false,hlColor:"C3DAF9",dh:Ext.DomHelper,fly:Ext.Element.fly,css:Ext.util.CSS,borderWidth:1,splitOffset:3,scrollIncrement:22,cellRE:/(?:.*?)x-grid-(?:hd|cell|csplit)-(?:[\d]+)-([\d]+)(?:.*?)/,findRE:/\s?(?:x-grid-hd|x-grid-col|x-grid-csplit)\s/,init:function(_2){Ext.grid.GridView.superclass.init.call(this,_2);this.bind(_2.dataSource,_2.colModel);_2.on("headerclick",this.handleHeaderClick,this);_2.cancelTextSelection=function(){};this.gridId=_2.id;var _3=this.templates||{};if(!_3.master){_3.master=new Ext.Template("<div class=\"x-grid\" hidefocus=\"true\">","<div class=\"x-grid-topbar\"></div>","<div class=\"x-grid-scroller\"><div></div></div>","<div class=\"x-grid-locked\">","<div class=\"x-grid-header\">{lockedHeader}</div>","<div class=\"x-grid-body\">{lockedBody}</div>","</div>","<div class=\"x-grid-viewport\">","<div class=\"x-grid-header\">{header}</div>","<div class=\"x-grid-body\">{body}</div>","</div>","<div class=\"x-grid-bottombar\"></div>","<a href=\"#\" class=\"x-grid-focus\" tabIndex=\"-1\"></a>","<div class=\"x-grid-resize-proxy\">&#160;</div>","</div>");_3.master.disableformats=true;}if(!_3.header){_3.header=new Ext.Template("<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">","<tbody><tr class=\"x-grid-hd-row\">{cells}</tr></tbody>","</table>{splits}");_3.header.disableformats=true;}_3.header.compile();if(!_3.hcell){_3.hcell=new Ext.Template("<td class=\"x-grid-hd x-grid-td-{id} {cellId}\"><div title=\"{title}\" class=\"x-grid-hd-inner x-grid-hd-{id}\">","<div class=\"x-grid-hd-text\" unselectable=\"on\">{value}<img class=\"x-grid-sort-icon\" src=\"",Ext.BLANK_IMAGE_URL,"\" /></div>","</div></td>");_3.hcell.disableFormats=true;}_3.hcell.compile();if(!_3.hsplit){_3.hsplit=new Ext.Template("<div class=\"x-grid-split {splitId} x-grid-split-{id}\" unselectable=\"on\">&#160;</div>");_3.hsplit.disableFormats=true;}_3.hsplit.compile();if(!_3.body){_3.body=new Ext.Template("<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">","<tbody>{rows}</tbody>","</table>");_3.body.disableFormats=true;}_3.body.compile();if(!_3.row){_3.row=new Ext.Template("<tr class=\"x-grid-row {alt}\">{cells}</tr>");_3.row.disableFormats=true;}_3.row.compile();if(!_3.cell){_3.cell=new Ext.Template("<td class=\"x-grid-col x-grid-td-{id} {cellId} {css}\" tabIndex=\"0\">","<div class=\"x-grid-col-{id} x-grid-cell-inner\"><div class=\"x-grid-cell-text\" unselectable=\"on\" {attr}>{value}</div></div>","</td>");_3.cell.disableFormats=true;}_3.cell.compile();this.templates=_3;},bind:function(ds,cm){if(this.ds){this.ds.un("datachanged",this.onDataChange);this.ds.un("add",this.onAdd);this.ds.un("remove",this.onRemove);this.ds.un("update",this.onUpdate);this.ds.un("clear",this.onClear);}if(ds){ds.on("datachanged",this.onDataChange,this);ds.on("add",this.onAdd,this);ds.on("remove",this.onRemove,this);ds.on("update",this.onUpdate,this);ds.on("clear",this.onClear,this);}this.ds=ds;if(this.cm){this.cm.un("widthchange",this.updateColumns,this);this.cm.un("headerchange",this.updateHeaders,this);this.cm.un("hiddenchange",this.handleHiddenChange,this);this.cm.un("columnmoved",this.handleColumnMove,this);this.cm.un("columnlockchange",this.handleLockChange,this);}if(cm){this.generateRules(cm);cm.on("widthchange",this.updateColumns,this);cm.on("headerchange",this.updateHeaders,this);cm.on("hiddenchange",this.handleHiddenChange,this);cm.on("columnmoved",this.handleColumnMove,this);cm.on("columnlockchange",this.handleLockChange,this);}this.cm=cm;},onDataChange:function(){this.refresh();this.updateHeaderSortState();},onClear:function(){this.refresh();},onUpdate:function(ds,_7){var _8=this.ds.indexOf(_7);var _9=this.getRowComposite(_8);var _a=[];this.insertRows(ds,_8,_8,true);this.onRemove(ds,_7,_8+1,true);this.syncRowHeights(_8,_8);this.layout();this.fireEvent("rowupdated",this,_8,_7);},onAdd:function(ds,_c,_d){this.insertRows(ds,_d,_d+(_c.length-1));},onRemove:function(ds,_f,_10,_11){if(_11!==true){this.fireEvent("beforerowremoved",this,_10,_f);}var bt=this.getBodyTable(),lt=this.getLockedTable();if(bt.rows[_10]){bt.firstChild.removeChild(bt.rows[_10]);}if(lt.rows[_10]){lt.firstChild.removeChild(lt.rows[_10]);}if(_11!==true){this.stripeRows(_10);this.syncRowHeights(_10,_10);this.layout();this.fireEvent("rowremoved",this,_10,_f);}},getHeaderPanel:function(_14){if(_14){this.headerPanel.show();}return this.headerPanel;},getFooterPanel:function(_15){if(_15){this.footerPanel.show();}return this.footerPanel;},initElements:function(){var E=Ext.Element;var el=this.grid.container.dom.firstChild;var cs=el.childNodes;this.el=new E(el);this.headerPanel=new E(el.firstChild);this.headerPanel.enableDisplayMode("block");this.scroller=new E(cs[1]);this.scrollSizer=new E(this.scroller.dom.firstChild);this.lockedWrap=new E(cs[2]);this.lockedHd=new E(this.lockedWrap.dom.firstChild);this.lockedBody=new E(this.lockedWrap.dom.childNodes[1]);this.mainWrap=new E(cs[3]);this.mainHd=new E(this.mainWrap.dom.firstChild);this.mainBody=new E(this.mainWrap.dom.childNodes[1]);this.footerPanel=new E(cs[4]);this.footerPanel.enableDisplayMode("block");this.focusEl=new E(cs[5]);this.focusEl.swallowEvent("click",true);this.resizeProxy=new E(cs[6]);this.headerSelector=String.format("#{0} td.x-grid-hd, #{1} td.x-grid-hd",this.lockedHd.id,this.mainHd.id);this.splitterSelector=String.format("#{0} div.x-grid-split, #{1} div.x-grid-split",this.lockedHd.id,this.mainHd.id);},getHeaderCell:function(_19){return Ext.DomQuery.select(this.headerSelector)[_19];},getHeaderCellMeasure:function(_1a){return this.getHeaderCell(_1a).firstChild;},getHeaderCellText:function(_1b){return this.getHeaderCell(_1b).firstChild.firstChild;},getLockedTable:function(){return this.lockedBody.dom.firstChild;},getBodyTable:function(){return this.mainBody.dom.firstChild;},getLockedRow:function(_1c){return this.getLockedTable().rows[_1c];},getRow:function(_1d){return this.getBodyTable().rows[_1d];},getRowComposite:function(_1e){if(!this.rowEl){this.rowEl=new Ext.CompositeElementLite();}var els=[],_20,_21;if(_20=this.getLockedRow(_1e)){els.push(_20);}if(_21=this.getRow(_1e)){els.push(_21);}this.rowEl.elements=els;return this.rowEl;},getCell:function(_22,_23){var _24=this.cm.getLockedCount();var _25;if(_23<_24){_25=this.lockedBody.dom.firstChild;}else{_25=this.mainBody.dom.firstChild;_23-=_24;}return _25.rows[_22].childNodes[_23];},getCellText:function(_26,_27){return this.getCell(_26,_27).firstChild.firstChild;},getCellBox:function(_28){var b=this.fly(_28).getBox();if(Ext.isOpera){b.y=_28.offsetTop+this.mainBody.getY();}return b;},getCellIndex:function(_2a){var id=String(_2a.className).match(this.cellRE);if(id){return parseInt(id[1],10);}return 0;},findHeaderIndex:function(n){var r=Ext.fly(n).findParent("td."+this.hdClass,6);return r?this.getCellIndex(r):false;},findHeaderCell:function(n){var r=Ext.fly(n).findParent("td."+this.hdClass,6);return r?r:false;},findRowIndex:function(n){var r=Ext.fly(n).findParent("tr."+this.rowClass,6);return r?r.rowIndex:false;},findCellIndex:function(_32){var _33=this.el.dom;while(_32&&_32!=_33){if(this.findRE.test(_32.className)){return this.getCellIndex(_32);}_32=_32.parentNode;}return false;},getColumnId:function(_34){return this.cm.getColumnId(_34);},getSplitters:function(){if(this.splitterSelector){return Ext.DomQuery.select(this.splitterSelector);}else{return null;}},getSplitter:function(_35){return this.getSplitters()[_35];},renderHeaders:function(){var cm=this.cm;var ct=this.templates.hcell,ht=this.templates.header,st=this.templates.hsplit;var cb=[],lb=[],sb=[],lsb=[],p={};for(var i=0,len=cm.getColumnCount();i<len;i++){p.cellId="x-grid-hd-0-"+i;p.splitId="x-grid-csplit-0-"+i;p.id=cm.getColumnId(i);p.title=cm.getColumnTooltip(i)||"";p.value=cm.getColumnHeader(i)||"";if(!cm.isLocked(i)){cb[cb.length]=ct.apply(p);sb[sb.length]=st.apply(p);}else{lb[lb.length]=ct.apply(p);lsb[lsb.length]=st.apply(p);}}return [ht.apply({cells:lb.join(""),splits:lsb.join("")}),ht.apply({cells:cb.join(""),splits:sb.join("")})];},updateHeaders:function(){var _41=this.renderHeaders();this.lockedHd.update(_41[0]);this.mainHd.update(_41[1]);},focusRow:function(row){var x=this.scroller.dom.scrollLeft;this.focusCell(row,0);this.scroller.dom.scrollLeft=x;},focusCell:function(row,col){var el=this.ensureVisible(row,col);this.focusEl.alignTo(el,"tl-tl");this.focusEl.focus.defer(1,this.focusEl);},ensureVisible:function(row,col){if(typeof row!="number"){row=row.rowIndex;}if(row<0&&row>=this.ds.getCount()){return;}col=(col!==undefined?col:0);var cm=this.grid.colModel;while(cm.isHidden(col)){col++;}var el=this.getCell(row,col);if(!el){return;}var c=this.scroller.dom;var _4c=parseInt(el.offsetTop,10);var _4d=parseInt(el.offsetLeft,10);var _4e=_4c+el.offsetHeight;var _4f=_4d+el.offsetWidth;var ch=c.clientHeight-this.mainHd.dom.offsetHeight;var _51=parseInt(c.scrollTop,10);var _52=parseInt(c.scrollLeft,10);var _53=_51+ch;var _54=_52+c.clientWidth;if(_4c<_51){c.scrollTop=_4c;}else{if(_4e>_53){c.scrollTop=_4e-ch;}}if(_4d<_52){c.scrollLeft=_4d;}else{if(_4f>_54){c.scrollLeft=_4f-c.clientWidth;}}return el;},updateColumns:function(){this.grid.stopEditing();var cm=this.grid.colModel,_56=this.getColumnIds();var pos=0;for(var i=0,len=cm.getColumnCount();i<len;i++){var w=cm.getColumnWidth(i);this.css.updateRule(this.colSelector+_56[i],"width",(w-this.borderWidth)+"px");this.css.updateRule(this.hdSelector+_56[i],"width",(w-this.borderWidth)+"px");}this.updateSplitters();},updateSplitters:function(){var cm=this.cm,s=this.getSplitters();if(s){var pos=0,_5e=true;for(var i=0,len=cm.getColumnCount();i<len;i++){if(cm.isHidden(i)){continue;}var w=cm.getColumnWidth(i);if(!cm.isLocked(i)&&_5e){pos=0;_5e=false;}pos+=w;s[i].style.left=(pos-this.splitOffset)+"px";}}},handleHiddenChange:function(_62,_63,_64){if(_64){this.hideColumn(_63);}else{this.unhideColumn(_63);}},hideColumn:function(_65){var cid=this.getColumnId(_65);this.css.updateRule(this.tdSelector+cid,"display","none");this.css.updateRule(this.splitSelector+cid,"display","none");if(Ext.isSafari){this.updateHeaders();}this.updateSplitters();this.layout();},unhideColumn:function(_67){var cid=this.getColumnId(_67);this.css.updateRule(this.tdSelector+cid,"display","");this.css.updateRule(this.splitSelector+cid,"display","");if(Ext.isSafari){this.updateHeaders();}this.updateSplitters();this.layout();},insertRows:function(dm,_6a,_6b,_6c){if(_6a==0&&_6b==dm.getCount()-1){this.refresh();}else{if(!_6c){this.fireEvent("beforerowsinserted",this,_6a,_6b);}var s=this.getScrollState();var _6e=this.renderRows(_6a,_6b);this.bufferRows(_6e[0],this.getLockedTable(),_6a);this.bufferRows(_6e[1],this.getBodyTable(),_6a);this.restoreScroll(s);if(!_6c){this.fireEvent("rowsinserted",this,_6a,_6b);this.syncRowHeights(_6a,_6b);this.layout();}}},bufferRows:function(_6f,_70,_71){var _72=null,_73=_70.rows,_74=_70.tBodies[0];if(_71<_73.length){_72=_73[_71];}var b=document.createElement("div");b.innerHTML="<table><tbody>"+_6f+"</tbody></table>";var _76=b.firstChild.rows;for(var i=0,len=_76.length;i<len;i++){if(_72){_74.insertBefore(_76[i],_72);}else{_74.appendChild(_76[i]);}}b.innerHTML="";b=null;},deleteRows:function(dm,_7a,_7b){if(dm.getRowCount()<1){this.fireEvent("beforerefresh",this);this.mainBody.update("");this.lockedBody.update("");this.fireEvent("refresh",this);}else{this.fireEvent("beforerowsdeleted",this,_7a,_7b);var bt=this.getBodyTable();var _7d=bt.firstChild;var _7e=bt.rows;for(var _7f=_7a;_7f<=_7b;_7f++){_7d.removeChild(_7e[_7a]);}this.stripeRows(_7a);this.fireEvent("rowsdeleted",this,_7a,_7b);}},updateRows:function(_80,_81,_82){var s=this.getScrollState();this.refresh();this.restoreScroll(s);},handleSort:function(_84,_85,_86,_87){if(!_87){this.refresh();}this.updateHeaderSortState();},getScrollState:function(){var sb=this.scroller.dom;return {left:sb.scrollLeft,top:sb.scrollTop};},stripeRows:function(_89){if(!this.grid.stripeRows||this.ds.getCount()<1){return;}_89=_89||0;var _8a=this.getBodyTable().rows;var _8b=this.getLockedTable().rows;var re=/x-grid-row-alt/g;for(var i=_89,len=_8a.length;i<len;i++){var row=_8a[i],_90=_8b[i];var _91=((i+1)%2==0);var _92=re.test(row.className);if(_91==_92){continue;}if(_91){row.className+=" x-grid-row-alt";}else{row.className=row.className.replace(re,"");}if(_90){_90.className=row.className;}}},restoreScroll:function(_93){var sb=this.scroller.dom;sb.scrollLeft=_93.left;sb.scrollTop=_93.top;this.syncScroll();},syncScroll:function(){var sb=this.scroller.dom;var sh=this.mainHd.dom;var bs=this.mainBody.dom;var lv=this.lockedBody.dom;sh.scrollLeft=bs.scrollLeft=sb.scrollLeft;lv.scrollTop=bs.scrollTop=sb.scrollTop;},handleScroll:function(e){this.syncScroll();var sb=this.scroller.dom;this.grid.fireEvent("bodyscroll",sb.scrollLeft,sb.scrollTop);e.stopEvent();},handleWheel:function(e){var d=e.getWheelDelta();this.scroller.dom.scrollTop-=d*22;this.lockedBody.dom.scrollTop=this.mainBody.dom.scrollTop=this.scroller.dom.scrollTop;e.stopEvent();},renderRows:function(_9d,_9e){var g=this.grid,cm=g.colModel,ds=g.dataSource,_a2=g.stripeRows;var _a3=cm.getColumnCount();if(ds.getCount()<1){return ["",""];}var cs=[];for(var i=0;i<_a3;i++){cs[i]={name:cm.getDataIndex(i)||ds.fields.get(i).name,renderer:cm.getRenderer(i),id:cm.getColumnId(i),locked:cm.isLocked(i)};}_9d=_9d||0;_9e=typeof _9e=="undefined"?ds.getCount()-1:_9e;var rs=ds.getRange(_9d,_9e);return this.doRender(cs,rs,ds,_9d,_a3,_a2);},doRender:Ext.isGecko?function(cs,rs,ds,_aa,_ab,_ac){var ts=this.templates,ct=ts.cell,rt=ts.row;var buf="",_b1="",cb,lcb,c,p={},rp={},r;for(var j=0,len=rs.length;j<len;j++){r=rs[j],cb="",lcb="",rowIndex=(j+_aa);for(var i=0;i<_ab;i++){c=cs[i];p.cellId="x-grid-cell-"+rowIndex+"-"+i;p.id=c.id;p.css=p.attr="";p.value=c.renderer(r.data[c.name],p,r,rowIndex,i,ds);if(p.value==undefined||p.value===""){p.value="&#160;";}var _bb=ct.apply(p);if(!c.locked){cb+=_bb;}else{lcb+=_bb;}}var alt="";if(_ac&&((rowIndex+1)%2==0)){alt="x-grid-row-alt";}rp.cells=lcb;rp.alt=alt;_b1+=rt.apply(rp);rp.cells=cb;buf+=rt.apply(rp);}return [_b1,buf];}:function(cs,rs,ds,_c0,_c1,_c2){var ts=this.templates,ct=ts.cell,rt=ts.row;var buf=[],_c7=[],cb,lcb,c,p={},rp={},r;for(var j=0,len=rs.length;j<len;j++){r=rs[j],cb=[],lcb=[],rowIndex=(j+_c0);for(var i=0;i<_c1;i++){c=cs[i];p.cellId="x-grid-cell-"+rowIndex+"-"+i;p.id=c.id;p.css=p.attr="";p.value=c.renderer(r.data[c.name],p,r,rowIndex,i,ds);if(p.value==undefined||p.value===""){p.value="&#160;";}var _d1=ct.apply(p);if(!c.locked){cb[cb.length]=_d1;}else{lcb[lcb.length]=_d1;}}var alt="";if(_c2&&((rowIndex+1)%2==0)){alt="x-grid-row-alt";}rp.cells=lcb.join("");rp.alt=alt;_c7[_c7.length]=rt.apply(rp);rp.cells=cb.join("");buf[buf.length]=rt.apply(rp);}return [_c7.join(""),buf.join("")];},renderBody:function(){var _d3=this.renderRows();var bt=this.templates.body;return [bt.apply({rows:_d3[0]}),bt.apply({rows:_d3[1]})];},refresh:function(_d5){this.fireEvent("beforerefresh",this);this.grid.stopEditing();var _d6=this.renderBody();this.lockedBody.update(_d6[0]);this.mainBody.update(_d6[1]);if(_d5===true){this.updateHeaders();this.updateColumns();this.updateSplitters();this.updateHeaderSortState();}this.syncRowHeights();this.layout();this.fireEvent("refresh",this);},handleColumnMove:function(cm,_d8,_d9){this.indexMap=null;var s=this.getScrollState();this.refresh(true);this.restoreScroll(s);this.afterMove(_d9);},afterMove:function(_db){if(this.enableMoveAnim&&Ext.enableFx){this.fly(this.getHeaderCell(_db).firstChild).highlight(this.hlColor);}},updateCell:function(dm,_dd,_de){var _df=this.getColumnIndexByDataIndex(_de);if(typeof _df=="undefined"){return;}var cm=this.grid.colModel;var _e1=this.getCell(_dd,_df);var _e2=this.getCellText(_dd,_df);var p={cellId:"x-grid-cell-"+_dd+"-"+_df,id:cm.getColumnId(_df),css:_df==cm.getColumnCount()-1?"x-grid-col-last":""};var _e4=cm.getRenderer(_df);var val=_e4(dm.getValueAt(_dd,_de),p,_dd,_df,dm);if(typeof val=="undefined"||val===""){val="&#160;";}_e2.innerHTML=val;_e1.className=this.cellClass+" "+p.cellId+" "+p.css;this.syncRowHeights(_dd,_dd);},calcColumnWidth:function(_e6,_e7){var _e8=0;if(this.grid.autoSizeHeaders){var h=this.getHeaderCellMeasure(_e6);_e8=Math.max(_e8,h.scrollWidth);}var tb,_eb;if(this.cm.isLocked(_e6)){tb=this.getLockedTable();_eb=_e6;}else{tb=this.getBodyTable();_eb=_e6-this.cm.getLockedCount();}if(tb&&tb.rows){var _ec=tb.rows;var _ed=Math.min(_e7||_ec.length,_ec.length);for(var i=0;i<_ed;i++){var _ef=_ec[i].childNodes[_eb].firstChild;_e8=Math.max(_e8,_ef.scrollWidth);}}return _e8+5;},autoSizeColumn:function(_f0,_f1,_f2){if(this.cm.isHidden(_f0)){return;}if(_f1){var cid=this.cm.getColumnId(_f0);this.css.updateRule(this.colSelector+cid,"width",this.grid.minColumnWidth+"px");if(this.grid.autoSizeHeaders){this.css.updateRule(this.hdSelector+cid,"width",this.grid.minColumnWidth+"px");}}var _f4=this.calcColumnWidth(_f0);this.cm.setColumnWidth(_f0,Math.max(this.grid.minColumnWidth,_f4),_f2);if(!_f2){this.grid.fireEvent("columnresize",_f0,_f4);}},autoSizeColumns:function(){var cm=this.grid.colModel;var _f6=cm.getColumnCount();for(var i=0;i<_f6;i++){this.autoSizeColumn(i,true,true);}if(cm.getTotalWidth()<this.scroller.dom.clientWidth){this.fitColumns();}else{this.updateColumns();this.layout();}},fitColumns:function(_f8){var cm=this.grid.colModel;var _fa=cm.getColumnCount();var _fb=[];var _fc=0;var i,w;for(i=0;i<_fa;i++){if(!cm.isHidden(i)&&!cm.isFixed(i)){w=cm.getColumnWidth(i);_fb.push(i);_fb.push(w);_fc+=w;}}var _ff=Math.min(this.scroller.dom.clientWidth,this.el.getWidth());if(_f8){_ff-=17;}var frac=(_ff-cm.getTotalWidth())/_fc;while(_fb.length){w=_fb.pop();i=_fb.pop();cm.setColumnWidth(i,Math.floor(w+w*frac),true);}this.updateColumns();this.layout();},onRowSelect:function(_101){var row=this.getRowComposite(_101);row.addClass("x-grid-row-selected");},onRowDeselect:function(_103){var row=this.getRowComposite(_103);row.removeClass("x-grid-row-selected");},onCellSelect:function(row,col){var cell=this.getCell(row,col);if(cell){Ext.fly(cell).addClass("x-grid-cell-selected");}},onCellDeselect:function(row,col){var cell=this.getCell(row,col);if(cell){Ext.fly(cell).removeClass("x-grid-cell-selected");}},updateHeaderSortState:function(){var _10b=this.ds.getSortState();if(!_10b){return;}this.sortState=_10b;var _10c=this.cm.findColumnIndex(_10b.field);if(_10c!=-1){var _10d=_10b.direction;var sc=this.sortClasses;var hds=this.el.select(this.headerSelector).removeClass(sc);hds.item(_10c).addClass(sc[_10d=="DESC"?1:0]);}},handleHeaderClick:function(g,_111){if(this.headersDisabled){return;}var dm=g.dataSource,cm=g.colModel;if(!cm.isSortable(_111)){return;}g.stopEditing();dm.sort(cm.getDataIndex(_111));},destroy:function(){this.bind(null,null);},handleLockChange:function(){this.refresh(true);},handleHdMenuClick:function(item){var _115=this.hdCtxIndex;var cm=this.cm,ds=this.ds;switch(item.id){case "asc":ds.sort(cm.getDataIndex(_115),"ASC");break;case "desc":ds.sort(cm.getDataIndex(_115),"DESC");break;case "lock":var lc=cm.getLockedCount();if(lc!=_115){cm.setLocked(_115,true,true);cm.moveColumn(_115,lc);this.grid.fireEvent("columnmove",_115,lc);}else{cm.setLocked(_115,true);}break;case "unlock":var lc=cm.getLockedCount();if((lc-1)!=_115){cm.setLocked(_115,false,true);cm.moveColumn(_115,lc-1);this.grid.fireEvent("columnmove",_115,lc-1);}else{cm.setLocked(_115,false);}break;default:_115=cm.getIndexById(item.id.substr(4));if(_115!=-1){cm.setHidden(_115,item.checked);}}return true;},beforeColMenuShow:function(){var cm=this.cm,_11a=cm.getColumnCount();this.colMenu.removeAll();for(var i=0;i<_11a;i++){this.colMenu.add(new Ext.menu.CheckItem({id:"col-"+cm.getColumnId(i),text:cm.getColumnHeader(i),checked:!cm.isHidden(i),hideOnClick:false}));}},handleHdCtx:function(g,_11d,e){e.stopEvent();var hd=this.getHeaderCell(_11d);this.hdCtxIndex=_11d;var ms=this.hmenu.items,cm=this.cm;ms.get("asc").setDisabled(!cm.isSortable(_11d));ms.get("desc").setDisabled(!cm.isSortable(_11d));if(this.grid.enableColLock!==false){ms.get("lock").setDisabled(cm.isLocked(_11d));ms.get("unlock").setDisabled(!cm.isLocked(_11d));}this.hmenu.show(hd,"tl-bl");},handleHdOver:function(e){var hd=this.findHeaderCell(e.getTarget());if(hd&&!this.headersDisabled){if(this.grid.colModel.isSortable(this.getCellIndex(hd))){this.fly(hd).addClass("x-grid-hd-over");}}},handleHdOut:function(e){var hd=this.findHeaderCell(e.getTarget());if(hd){this.fly(hd).removeClass("x-grid-hd-over");}},handleSplitDblClick:function(e,t){var i=this.getCellIndex(t);this.autoSizeColumn(i,true);this.layout();},render:function(){var cm=this.cm;var _12a=cm.getColumnCount();if(this.grid.monitorWindowResize===true){Ext.EventManager.onWindowResize(this.onWindowResize,this,true);}var _12b=this.renderHeaders();var body=this.templates.body.apply({rows:""});var html=this.templates.master.apply({lockedBody:body,body:body,lockedHeader:_12b[0],header:_12b[1]});this.updateColumns();this.grid.container.dom.innerHTML=html;this.initElements();this.scroller.on("scroll",this.handleScroll,this);this.lockedBody.on("mousewheel",this.handleWheel,this);this.mainBody.on("mousewheel",this.handleWheel,this);this.mainHd.on("mouseover",this.handleHdOver,this);this.mainHd.on("mouseout",this.handleHdOut,this);this.mainHd.on("dblclick",this.handleSplitDblClick,this,{delegate:"."+this.splitClass});this.lockedHd.on("mouseover",this.handleHdOver,this);this.lockedHd.on("mouseout",this.handleHdOut,this);this.lockedHd.on("dblclick",this.handleSplitDblClick,this,{delegate:"."+this.splitClass});if(this.grid.enableColumnResize!==false){new Ext.grid.SplitDragZone(this.grid,this.lockedHd.dom,this.mainHd.dom);}this.updateSplitters();if(this.grid.enableColumnMove){new Ext.grid.HeaderDragZone(this.grid,this.lockedHd.dom,this.mainHd.dom);new Ext.grid.HeaderDropZone(this.grid,this.lockedHd.dom,this.mainHd.dom);}if(this.grid.enableCtxMenu!==false){this.colMenu=new Ext.menu.Menu({id:this.grid.id+"-hcols-menu"});this.colMenu.on("beforeshow",this.beforeColMenuShow,this);this.colMenu.on("itemclick",this.handleHdMenuClick,this);this.hmenu=new Ext.menu.Menu({id:this.grid.id+"-hctx"});this.hmenu.add({id:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{id:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"},"separator");if(this.grid.enableColLock!==false){this.hmenu.add({id:"lock",text:this.lockText,cls:"xg-hmenu-lock"},{id:"unlock",text:this.unlockText,cls:"xg-hmenu-unlock"},"separator");}this.hmenu.add({id:"columns",text:this.columnsText,menu:this.colMenu});this.hmenu.on("itemclick",this.handleHdMenuClick,this);this.grid.on("headercontextmenu",this.handleHdCtx,this);}for(var i=0;i<_12a;i++){if(cm.isHidden(i)){this.hideColumn(i);}if(cm.config[i].align){this.css.updateRule(this.colSelector+i,"textAlign",cm.config[i].align);this.css.updateRule(this.hdSelector+i,"textAlign",cm.config[i].align);}}this.updateHeaderSortState();this.beforeInitialResize();this.layout(true);this.renderPhase2.defer(1,this);},renderPhase2:function(){this.refresh();if(this.grid.autoSizeColumns){this.autoSizeColumns();}},beforeInitialResize:function(){},onColumnSplitterMoved:function(i,w){var cm=this.grid.colModel;cm.setColumnWidth(i,w,true);var cid=cm.getColumnId(i);this.css.updateRule(this.colSelector+cid,"width",(w-this.borderWidth)+"px");this.css.updateRule(this.hdSelector+cid,"width",(w-this.borderWidth)+"px");this.updateSplitters();this.layout();this.grid.fireEvent("columnresize",i,w);},syncRowHeights:function(_133,_134){if(this.grid.enableRowHeightSync===true&&this.cm.getLockedCount()>0){_133=_133||0;var _135=this.getBodyTable().rows;var _136=this.getLockedTable().rows;var len=_135.length-1;_134=Math.min(_134||len,len);for(var i=_133;i<=_134;i++){var m=_135[i],l=_136[i];var h=Math.max(m.offsetHeight,l.offsetHeight);m.style.height=l.style.height=h+"px";}}},layout:function(_13c){var auto=this.grid.autoHeight;var _13e=16;var c=this.grid.container;c.beginMeasure();var tbh=this.headerPanel.getHeight();var bbh=this.footerPanel.getHeight();if(auto){var ch=this.getBodyTable().offsetHeight+tbh+bbh+this.mainHd.getHeight();c.setHeight(ch+c.getBorderWidth("tb"));}var s=this.scroller;var _144=c.getSize(true);this.el.setSize(_144.width,_144.height);this.headerPanel.setWidth(_144.width);this.footerPanel.setWidth(_144.width);var _145=this.mainHd.getHeight();var vw=_144.width;var vh=_144.height-(tbh+bbh);s.setSize(vw,vh);var bt=this.getBodyTable();var _149=Math.max(this.getLockedTable().offsetWidth,this.lockedHd.dom.firstChild.offsetWidth);var _14a=bt.offsetHeight;var _14b=_149+bt.offsetWidth;var _14c=false,_14d=false;this.scrollSizer.setSize(_14b,_14a+_145);var lw=this.lockedWrap,mw=this.mainWrap;var lb=this.lockedBody,mb=this.mainBody;setTimeout(function(){var t=s.dom.offsetTop;var w=s.dom.clientWidth,h=auto?s.dom.offsetHeight:s.dom.clientHeight;lw.setTop(t);lw.setSize(_149,h);mw.setLeftTop(_149,t);mw.setSize(w-_149,h);lb.setHeight(h-_145);mb.setHeight(h-_145);if(_13c){lw.show();mw.show();}c.endMeasure();},10);},onWindowResize:function(){if(!this.grid.monitorWindowResize||this.grid.autoHeight){return;}this.layout();},appendFooter:function(_155){return null;},sortAscText:"Sort Ascending",sortDescText:"Sort Descending",lockText:"Lock Column",unlockText:"Unlock Column",columnsText:"Columns"});if(Ext.dd.DragZone){Ext.grid.HeaderDragZone=function(grid,hd,hd2){this.grid=grid;this.view=grid.getView();this.ddGroup="gridHeader"+this.grid.container.id;Ext.grid.HeaderDragZone.superclass.constructor.call(this,hd);this.setHandleElId(Ext.id(hd));this.setOuterHandleElId(Ext.id(hd2));this.scroll=false;};Ext.extend(Ext.grid.HeaderDragZone,Ext.dd.DragZone,{maxDragWidth:120,getDragData:function(e){var t=Ext.lib.Event.getTarget(e);var h=this.view.findHeaderCell(t);if(h){return {ddel:h.firstChild,header:h};}return false;},onInitDrag:function(e){var _15d=this.dragData.ddel.cloneNode(true);_15d.style.width=Math.min(this.dragData.header.offsetWidth,this.maxDragWidth)+"px";this.proxy.update(_15d);return true;}});Ext.grid.SplitDragZone=function(grid,hd,hd2){this.grid=grid;this.view=grid.getView();this.proxy=this.view.resizeProxy;Ext.grid.SplitDragZone.superclass.constructor.call(this,hd,"gridSplitters"+this.grid.container.id,{dragElId:Ext.id(this.proxy.dom),resizeFrame:false});this.setHandleElId(Ext.id(hd));this.setOuterHandleElId(Ext.id(hd2));this.scroll=false;};Ext.extend(Ext.grid.SplitDragZone,Ext.dd.DDProxy,{fly:Ext.Element.fly,b4StartDrag:function(x,y){this.view.headersDisabled=true;this.proxy.setHeight(this.view.mainWrap.getHeight());var w=this.cm.getColumnWidth(this.cellIndex);var minw=Math.max(w-this.grid.minColumnWidth,0);this.resetConstraints();this.setXConstraint(minw,1000);this.setYConstraint(0,0);this.minX=x-minw;this.maxX=x+1000;this.startPos=x;Ext.dd.DDProxy.prototype.b4StartDrag.call(this,x,y);},handleMouseDown:function(e){ev=Ext.EventObject.setEvent(e);var t=this.fly(ev.getTarget());if(t.hasClass("x-grid-split")){this.cellIndex=this.view.getCellIndex(t.dom);this.split=t.dom;this.cm=this.grid.colModel;if(this.cm.isResizable(this.cellIndex)&&!this.cm.isFixed(this.cellIndex)){Ext.grid.SplitDragZone.superclass.handleMouseDown.apply(this,arguments);}}},endDrag:function(e){this.view.headersDisabled=false;var endX=Ext.lib.Event.getPageX(e);var diff=endX-this.startPos;this.view.onColumnSplitterMoved(this.cellIndex,this.cm.getColumnWidth(this.cellIndex)+diff);},autoOffset:function(){this.setDelta(0,0);}});Ext.grid.HeaderDropZone=function(grid,hd,hd2){this.grid=grid;this.view=grid.getView();this.proxyTop=Ext.DomHelper.append(document.body,{tag:"div",cls:"col-move-top",html:"&#160;"},true);this.proxyBottom=Ext.DomHelper.append(document.body,{tag:"div",cls:"col-move-bottom",html:"&#160;"},true);this.proxyTop.hide=this.proxyBottom.hide=function(){this.setLeftTop(-100,-100);this.setStyle("visibility","hidden");};this.ddGroup="gridHeader"+this.grid.container.id;Ext.grid.HeaderDropZone.superclass.constructor.call(this,grid.container.dom);};Ext.extend(Ext.grid.HeaderDropZone,Ext.dd.DropZone,{proxyOffsets:[-4,-9],fly:Ext.Element.fly,getTargetFromEvent:function(e){var t=Ext.lib.Event.getTarget(e);var _16f=this.view.findCellIndex(t);if(_16f!==false){return this.view.getHeaderCell(_16f);}},nextVisible:function(h){var v=this.view,cm=this.grid.colModel;h=h.nextSibling;while(h){if(!cm.isHidden(v.getCellIndex(h))){return h;}h=h.nextSibling;}return null;},prevVisible:function(h){var v=this.view,cm=this.grid.colModel;h=h.prevSibling;while(h){if(!cm.isHidden(v.getCellIndex(h))){return h;}h=h.prevSibling;}return null;},positionIndicator:function(h,n,e){var x=Ext.lib.Event.getPageX(e);var r=Ext.lib.Dom.getRegion(n.firstChild);var px,pt,py=r.top+this.proxyOffsets[1];if((r.right-x)<=(r.right-r.left)/2){px=r.right+this.view.borderWidth;pt="after";}else{px=r.left;pt="before";}var _17e=this.view.getCellIndex(h);var _17f=this.view.getCellIndex(n);var _180=this.grid.colModel.isLocked(_17f);if(pt=="after"){_17f++;}if(_17e<_17f){_17f--;}if(_17e==_17f&&(_180==this.grid.colModel.isLocked(_17e))){return false;}px+=this.proxyOffsets[0];this.proxyTop.setLeftTop(px,py);this.proxyTop.show();if(!this.bottomOffset){this.bottomOffset=this.view.mainHd.getHeight();}this.proxyBottom.setLeftTop(px,py+this.proxyTop.dom.offsetHeight+this.bottomOffset);this.proxyBottom.show();return pt;},onNodeEnter:function(n,dd,e,data){if(data.header!=n){this.positionIndicator(data.header,n,e);}},onNodeOver:function(n,dd,e,data){var _189=false;if(data.header!=n){_189=this.positionIndicator(data.header,n,e);}if(!_189){this.proxyTop.hide();this.proxyBottom.hide();}return _189?this.dropAllowed:this.dropNotAllowed;},onNodeOut:function(n,dd,e,data){this.proxyTop.hide();this.proxyBottom.hide();},onNodeDrop:function(n,dd,e,data){var h=data.header;if(h!=n){var cm=this.grid.colModel;var x=Ext.lib.Event.getPageX(e);var r=Ext.lib.Dom.getRegion(n.firstChild);var pt=(r.right-x)<=((r.right-r.left)/2)?"after":"before";var _197=this.view.getCellIndex(h);var _198=this.view.getCellIndex(n);var _199=cm.isLocked(_198);if(pt=="after"){_198++;}if(_197<_198){_198--;}if(_197==_198&&(_199==cm.isLocked(_197))){return false;}cm.setLocked(_197,_199,true);cm.moveColumn(_197,_198);this.grid.fireEvent("columnmove",_197,_198);return true;}return false;}});}
