/*
 * Ext - JS Library 1.0 Alpha 2
 * Copyright(c) 2006-2007, Jack Slocum.
 * 
 * http://www.extjs.com/license.txt
 */

Ext.menu.Menu=function(_1){Ext.apply(this,_1);this.id=this.id||Ext.id();this.events={beforeshow:true,beforehide:true,show:true,hide:true,click:true,mouseover:true,mouseout:true,itemclick:true};Ext.menu.MenuMgr.register(this);var _2=this.items;this.items=new Ext.util.MixedCollection();if(_2){this.add.apply(this,_2);}};Ext.extend(Ext.menu.Menu,Ext.util.Observable,{minWidth:120,shadow:"sides",subMenuAlign:"tl-tr?",defaultAlign:"tl-bl?",allowOtherMenus:false,render:function(){if(this.el){return;}var _3=this.parentEl||document.body;var el=this.el=new Ext.Layer({cls:"x-menu",shadow:this.shadow,constrain:false});this.keyNav=new Ext.menu.MenuNav(this);if(this.plain){el.addClass("x-menu-plain");}if(this.cls){el.addClass(this.cls);}this.focusEl=el.createChild({tag:"a",cls:"x-menu-focus",href:"#",onclick:"return false;",tabIndex:"-1"});var ul=el.createChild({tag:"ul",cls:"x-menu-list"});ul.on("click",this.onClick,this);ul.on("mouseover",this.onMouseOver,this);ul.on("mouseout",this.onMouseOut,this);this.items.each(function(_6){var li=document.createElement("li");li.className="x-menu-list-item";ul.dom.appendChild(li);_6.render(li,this);},this);this.ul=ul;this.autoWidth();},autoWidth:function(){var el=this.el,ul=this.ul;if(!el){return;}var w=this.width;if(w){el.setWidth(w);}else{if(Ext.isIE){el.setWidth(this.minWidth);var t=el.dom.offsetWidth;el.setWidth(ul.getWidth()+el.getFrameWidth("lr"));}}},delayAutoWidth:function(){if(!this.awTask){this.awTask=new Ext.util.DelayedTask(this.autoWidth,this);}this.awTask.delay(20);},findTargetItem:function(e){var t=e.getTarget(".x-menu-list-item",this.ul,true);if(t&&t.menuItemId){return this.items.get(t.menuItemId);}},onClick:function(e){var t;if(t=this.findTargetItem(e)){t.onClick(e);this.fireEvent("click",this,t,e);}},setActiveItem:function(_10,_11){if(_10!=this.activeItem){if(this.activeItem){this.activeItem.deactivate();}this.activeItem=_10;_10.activate(_11);}else{if(_11){_10.expandMenu();}}},tryActivate:function(_12,_13){var _14=this.items;for(var i=_12,len=_14.length;i>=0&&i<len;i+=_13){var _17=_14.get(i);if(!_17.disabled&&_17.canActivate){this.setActiveItem(_17,false);return _17;}}return false;},onMouseOver:function(e){var t;if(t=this.findTargetItem(e)){if(t.canActivate&&!t.disabled){this.setActiveItem(t,true);}}this.fireEvent("mouseover",this,e);},onMouseOut:function(e){var t;if(t=this.findTargetItem(e)){if(t==this.activeItem&&t.shouldDeactivate(e)){this.activeItem.deactivate();delete this.activeItem;}}this.fireEvent("mouseout",this,e);},isVisible:function(){return this.el&&this.el.isVisible();},show:function(el,pos,_1e){this.parentMenu=_1e;if(!this.el){this.render();}this.fireEvent("beforeshow",this);this.showAt(this.el.getAlignToXY(el,pos||this.defaultAlign),_1e,false);},showAt:function(xy,_20,_21){this.parentMenu=_20;if(!this.el){this.render();}if(_21!==false){this.fireEvent("beforeshow",this);}this.el.setXY(xy);this.el.show();this.focusEl.focus.defer(50,this.focusEl);this.fireEvent("show",this);},hide:function(_22){if(this.el&&this.isVisible()){this.fireEvent("beforehide",this);if(this.activeItem){this.activeItem.deactivate();this.activeItem=null;}this.el.hide();this.fireEvent("hide",this);}if(_22===true&&this.parentMenu){this.parentMenu.hide(true);}},add:function(){var a=arguments,l=a.length,_25;for(var i=0;i<l;i++){var el=a[i];if(el.render){_25=this.addItem(el);}else{if(typeof el=="string"){if(el=="separator"||el=="-"){_25=this.addSeparator();}else{_25=this.addText(el);}}else{if(el.tagName||el.el){_25=this.addElement(el);}else{if(typeof el=="object"){_25=this.addMenuItem(el);}}}}}return _25;},getEl:function(){if(!this.el){this.render();}return this.el;},addSeparator:function(){return this.addItem(new Ext.menu.Separator());},addElement:function(el){return this.addItem(new Ext.menu.BaseItem(el));},addItem:function(_29){this.items.add(_29);if(this.ul){var li=document.createElement("li");li.className="x-menu-list-item";this.ul.dom.appendChild(li);_29.render(li,this);this.delayAutoWidth();}return _29;},addMenuItem:function(_2b){if(!(_2b instanceof Ext.menu.Item)){_2b=new Ext.menu.Item(_2b);}return this.addItem(_2b);},addText:function(_2c){return this.addItem(new Ext.menu.TextItem(_2c));},insert:function(_2d,_2e){this.items.insert(_2d,_2e);if(this.ul){var li=document.createElement("li");li.className="x-menu-list-item";this.ul.dom.insertBefore(li,this.ul.dom.childNodes[_2d]);_2e.render(li,this);this.delayAutoWidth();}return _2e;},remove:function(_30){this.items.removeKey(_30.id);_30.destroy();},removeAll:function(){var f;while(f=this.items.first()){this.remove(f);}}});Ext.menu.MenuNav=function(_32){Ext.menu.MenuNav.superclass.constructor.call(this,_32.el);this.scope=this.menu=_32;};Ext.extend(Ext.menu.MenuNav,Ext.KeyNav,{doRelay:function(e,h){var k=e.getKey();if(!this.menu.activeItem&&e.isNavKeyPress()&&k!=e.SPACE&&k!=e.RETURN){this.menu.tryActivate(0,1);return false;}return h.call(this.scope||this,e,this.menu);},up:function(e,m){if(!m.tryActivate(m.items.indexOf(m.activeItem)-1,-1)){m.tryActivate(m.items.length-1,-1);}},down:function(e,m){if(!m.tryActivate(m.items.indexOf(m.activeItem)+1,1)){m.tryActivate(0,1);}},right:function(e,m){if(m.activeItem){m.activeItem.expandMenu(true);}},left:function(e,m){m.hide();if(m.parentMenu&&m.parentMenu.activeItem){m.parentMenu.activeItem.activate();}},enter:function(e,m){if(m.activeItem){e.stopPropagation();m.activeItem.onClick(e);m.fireEvent("click",this,m.activeItem);return true;}}});
