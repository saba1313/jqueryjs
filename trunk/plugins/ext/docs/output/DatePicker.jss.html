<html><head><title>DatePicker.js</title><link rel="stylesheet" type="text/css" href="../resources/style.css" media="screen"/></head><body><h1>DatePicker.js</h1><pre class="highlighted"><code>Ext.DatePicker = <b>function</b>(config){
    Ext.DatePicker.superclass.constructor.call(<b>this</b>, config);
    <b>this</b>.value = <b>new</b> Date().clearTime();

    <b>this</b>.addEvents({select: true});

    <b>if</b>(this.handler){
        <b>this</b>.on('select', <b>this</b>.handler,  <b>this</b>.scope || <b>this</b>);
    }
    <i>// build the disabledDatesRE</i>
    <b>if</b>(!<b>this</b>.disabledDatesRE &amp;&amp; <b>this</b>.disabledDates){
        <b>var</b> dd = <b>this</b>.disabledDates;
        <b>var</b> re = &quot;(?:&quot;;
        <b>for</b>(var i = 0; i &lt; dd.length; i++){
            re += dd[i];
            <b>if</b>(i != dd.length-1) re += &quot;|&quot;;
        }
        <b>this</b>.disabledDatesRE = <b>new</b> RegExp(re + &quot;)&quot;);
    }
};

Ext.extend(Ext.DatePicker, Ext.Component, {

    startDay : 0,

    setValue : <b>function</b>(value){
        <b>var</b> old = <b>this</b>.value;
        <b>this</b>.value = value.clearTime(true);
        <b>if</b>(this.rendered){
            <b>this</b>.update(<b>this</b>.value);
        }
    },

    getValue : <b>function</b>(){
        <b>return</b> this.value;
    },

    focus : <b>function</b>(){
        <b>if</b>(this.rendered){
            <b>this</b>.update(<b>this</b>.activeDate);
        }
    },

    onRender : <b>function</b>(container){
        <b>var</b> m = [
             '&lt;table cellspacing=&quot;0&quot;&gt;',
                '&lt;tr&gt;&lt;td class=&quot;x-date-left&quot;&gt;&lt;a href=&quot;#&quot; title=&quot;', <b>this</b>.prevText ,'&quot;&gt;&amp;#160;&lt;/a&gt;&lt;/td&gt;&lt;td class=&quot;x-date-middle&quot; align=&quot;center&quot;&gt;&lt;/td&gt;&lt;td class=&quot;x-date-right&quot;&gt;&lt;a href=&quot;#&quot; title=&quot;', <b>this</b>.nextText ,'&quot;&gt;&amp;#160;&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;',
                '&lt;tr&gt;&lt;td colspan=&quot;3&quot;&gt;&lt;table class=&quot;x-date-inner&quot; cellspacing=&quot;0&quot;&gt;&lt;thead&gt;&lt;tr&gt;'];
        <b>var</b> dn = <b>this</b>.dayNames;
        <b>for</b>(var i = 0; i &lt; 7; i++){
            <b>var</b> d = <b>this</b>.startDay+i;
            <b>if</b>(d &gt; 6){
                d = d-7;
            }
            m.push('&lt;th&gt;&lt;span&gt;', dn[d].substr(0,1), '&lt;/span&gt;&lt;/th&gt;');
        }
        m[m.length] = '&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;';
        <b>for</b>(var i = 0; i &lt; 42; i++) {
            <b>if</b>(i % 7 == 0 &amp;&amp; i != 0){
                m[m.length] = '&lt;/tr&gt;&lt;tr&gt;';
            }
            m[m.length] = '&lt;td&gt;&lt;a href=&quot;#&quot; hidefocus=&quot;on&quot; class=&quot;x-date-date&quot; tabIndex=&quot;1&quot;&gt;&lt;em&gt;&lt;span&gt;&lt;/span&gt;&lt;/em&gt;&lt;/a&gt;&lt;/td&gt;';
        }
        m[m.length] = '&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td colspan=&quot;3&quot; class=&quot;x-date-bottom&quot; align=&quot;center&quot;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;';

        <b>var</b> el = document.createElement('div');
        el.className = 'x-date-picker';
        el.innerHTML = m.join('');

        container.dom.appendChild(el);

        <b>this</b>.el = Ext.get(el);
        <b>new</b> Ext.util.ClickRepeater(<b>this</b>.el.child('td.x-date-left a'), {handler: <b>this</b>.showPrevMonth, scope: <b>this</b>});
        <b>new</b> Ext.util.ClickRepeater(<b>this</b>.el.child('td.x-date-right a'), {handler: <b>this</b>.showNextMonth, scope: <b>this</b>});

        <b>this</b>.el.on('mousewheel', <b>this</b>.handleMouseWheel,  <b>this</b>);


        <b>var</b> kn = <b>new</b> Ext.KeyNav(<b>this</b>.el, {
            'left' : <b>function</b>(e){
                e.ctrlKey ?
                    <b>this</b>.showPrevMonth() :
                    <b>this</b>.update(<b>this</b>.activeDate.add('d', -1));
            },

            'right' : <b>function</b>(e){
                e.ctrlKey ?
                    <b>this</b>.showNextMonth() :
                    <b>this</b>.update(<b>this</b>.activeDate.add('d', 1));
            },

            'up' : <b>function</b>(e){
                e.ctrlKey ?
                    <b>this</b>.showNextYear() :
                    <b>this</b>.update(<b>this</b>.activeDate.add('d', -7));
            },

            'down' : <b>function</b>(e){
                e.ctrlKey ?
                    <b>this</b>.showPrevYear() :
                    <b>this</b>.update(<b>this</b>.activeDate.add('d', 7));
            },

            'pageUp' : <b>function</b>(e){
                <b>this</b>.showNextMonth();
            },

            'pageDown' : <b>function</b>(e){
                <b>this</b>.showPrevMonth();
            },

            'enter' : <b>function</b>(e){
                e.stopPropagation();
                <b>return</b> true;
            },

            scope : <b>this</b>
        });

        <b>this</b>.el.on('click', <b>this</b>.handleDateClick,  <b>this</b>, {delegate: 'a.x-date-date'});

        <b>this</b>.el.addKeyListener(Ext.EventObject.SPACE, <b>this</b>.selectToday,  <b>this</b>);

        <b>this</b>.el.unselectable();
        
        <b>this</b>.cells = <b>this</b>.el.select('table.x-date-inner tbody td');
        <b>this</b>.textNodes = <b>this</b>.el.query('table.x-date-inner tbody span');

        <b>var</b> mmenu = <b>new</b> Ext.menu.Menu({
            plain:true,
            cls: 'x-date-mmenu',
            allowOtherMenus : true
        });

        <b>var</b> menuGroup = Ext.id()+'months';
        <b>for</b>(var i = 0; i &lt; 12; i++){
            mmenu.add(<b>new</b> Ext.menu.CheckItem({
                id: 'mm-'+i,
                text: <b>this</b>.monthNames[i],
                group:menuGroup,
                month: i
            }));
        }

        mmenu.on({
            'beforeshow' : <b>function</b>(){
                mmenu.items.get('mm-'+(<b>this</b>.activeDate || <b>this</b>.value).getMonth()).setChecked(true);
            },
            'itemclick' : <b>function</b>(item){
                <b>var</b> d = (<b>this</b>.activeDate || <b>this</b>.value).clone();
                d.setMonth(item.month);
                <b>this</b>.update(d);
            },
            'show' : <b>function</b>(m){
                <b>this</b>.visibleRegion = m.el.getRegion().adjust(2, 2, -2, -2);
            },
            'mouseout' : <b>function</b>(m, e){
                <b>if</b>(!<b>this</b>.visibleRegion.contains(e.getPoint())){
                    m.hide();
                }
            },
            scope: <b>this</b>
        });

        <b>this</b>.mbtn = <b>new</b> Ext.Button(<b>this</b>.el.child('td.x-date-middle', true), {
            menu: mmenu,
            text: '&amp;#160;',
            menuAlign: 'c-c?',
            tooltip: <b>this</b>.monthYearText
        });

        <b>var</b> today = (<b>new</b> Date()).format(<b>this</b>.format);
        <b>var</b> todayBtn = <b>new</b> Ext.Button(<b>this</b>.el.child('td.x-date-bottom', true), {
            text: String.format(<b>this</b>.todayText, today),
            tooltip: String.format(<b>this</b>.todayTip, today),
            handler: <b>this</b>.selectToday,
            scope: <b>this</b>
        });
        
        <b>if</b>(Ext.isIE){
            <b>this</b>.el.repaint();
        }
        <b>this</b>.update(<b>this</b>.value);
    },
    
    showPrevMonth : <b>function</b>(e){
        <b>this</b>.update(<b>this</b>.activeDate.add('mo', -1));
    },
    
    showNextMonth : <b>function</b>(e){
        <b>this</b>.update(<b>this</b>.activeDate.add('mo', 1));
    },
    
    showPrevYear : <b>function</b>(){
        <b>this</b>.update(<b>this</b>.activeDate.add('y', -1));
    },
    
    showNextYear : <b>function</b>(){
        <b>this</b>.update(<b>this</b>.activeDate.add('y', 1));
    },
    
    handleMouseWheel : <b>function</b>(e){
        <b>var</b> delta = e.getWheelDelta();
        <b>if</b>(delta &gt; 0){
            <b>this</b>.showPrevMonth();
            e.stopEvent();
        } <b>else</b> if(delta &lt; 0){
            <b>this</b>.showNextMonth();
            e.stopEvent();
        }
    },
    
    handleDateClick : <b>function</b>(e, t){
        e.stopEvent();
        <b>if</b>(t.dateValue &amp;&amp; !Ext.fly(t.parentNode).hasClass('x-date-disabled')){
            <b>this</b>.setValue(<b>new</b> Date(t.dateValue));
            <b>this</b>.fireEvent('select', <b>this</b>, <b>this</b>.value);
        }
    },
    
    selectToday : <b>function</b>(){
        <b>this</b>.setValue(<b>new</b> Date().clearTime());
        <b>this</b>.fireEvent('select', <b>this</b>, <b>this</b>.value);
    },
    
    update : <b>function</b>(date){
        <b>var</b> vd = <b>this</b>.activeDate;
        <b>this</b>.activeDate = date;

        <b>if</b>(vd &amp;&amp; <b>this</b>.rendered){
            <b>var</b> t = date.getTime();
            <b>if</b>(vd.getMonth() == date.getMonth() &amp;&amp; vd.getFullYear() == date.getFullYear()){
                <b>this</b>.cells.removeClass('x-date-selected');
                <b>this</b>.cells.each(<b>function</b>(c){
                   <b>if</b>(c.dom.firstChild.dateValue == t){
                       c.addClass('x-date-selected');
                       setTimeout(<b>function</b>(){
                            try{c.dom.firstChild.focus();}catch(e){}
                       }, 50);
                       <b>return</b> false;
                   }
                });
                <b>return</b>;
            }
        }
        <b>var</b> days = date.getDaysInMonth();
        <b>var</b> firstOfMonth = date.getFirstDateOfMonth();
        <b>var</b> startingPos = firstOfMonth.getDay()-<b>this</b>.startDay;

        <b>if</b>(startingPos &lt;= <b>this</b>.startDay){
            startingPos += 7;
        }

        <b>var</b> pm = date.add('mo', -1);
        <b>var</b> prevStart = pm.getDaysInMonth()-startingPos;

        <b>var</b> cells = <b>this</b>.cells.elements;
        <b>var</b> textEls = <b>this</b>.textNodes;
        days += startingPos;

        <i>// convert everything to numbers so it's fast</i>
        <b>var</b> day = 86400000;
        <b>var</b> d = (<b>new</b> Date(pm.getFullYear(), pm.getMonth(), prevStart)).clearTime();
        <b>var</b> today = <b>new</b> Date().clearTime().getTime();
        <b>var</b> sel = date.clearTime().getTime();
        <b>var</b> min = <b>this</b>.minDate ? <b>this</b>.minDate.clearTime() : Number.NEGATIVE_INFINITY;
        <b>var</b> max = <b>this</b>.maxDate ? <b>this</b>.maxDate.clearTime() : Number.POSITIVE_INFINITY;
        <b>var</b> ddMatch = <b>this</b>.disabledDatesRE;
        <b>var</b> ddText = <b>this</b>.disabledDatesText;
        <b>var</b> ddays = <b>this</b>.disabledDays ? <b>this</b>.disabledDays.join('') : false;
        <b>var</b> ddaysText = <b>this</b>.disabledDaysText;
        <b>var</b> format = <b>this</b>.format;

        <b>var</b> setCellClass = <b>function</b>(cal, cell){
            cell.title = '';
            <b>var</b> t = d.getTime();
            cell.firstChild.dateValue = t;
            <b>if</b>(t == today){
                cell.className += ' x-date-today';
                cell.title = cal.todayText;
            }
            <b>if</b>(t == sel){
                cell.className += ' x-date-selected';
                setTimeout(<b>function</b>(){
                    try{cell.firstChild.focus();}catch(e){}
                }, 50);
            }
            <i>// disabling</i>
            <b>if</b>(t &lt; min) {
                cell.className = ' x-date-disabled';
                cell.title = cal.minText;
                <b>return</b>;
            }
            <b>if</b>(t &gt; max) {
                cell.className = ' x-date-disabled';
                cell.title = cal.maxText;
                <b>return</b>;
            }
            <b>if</b>(ddays){
                <b>if</b>(ddays.indexOf(d.getDay()) != -1){
                    cell.title = ddaysText;
                    cell.className = ' x-date-disabled';
                }
            }
            <b>if</b>(ddMatch &amp;&amp; format){
                <b>var</b> fvalue = d.format(format);
                <b>if</b>(ddMatch.test(fvalue)){
                    cell.title = ddText.replace('%0', fvalue);
                    cell.className = ' x-date-disabled';
                }
            }
        };

        <b>var</b> i = 0;
        <b>for</b>(; i &lt; startingPos; i++) {
            textEls[i].innerHTML = (++prevStart);
            d.setDate(d.getDate()+1);
            cells[i].className = 'x-date-prevday';
            setCellClass(<b>this</b>, cells[i]);
        }
        <b>for</b>(; i &lt; days; i++){
            intDay = i - startingPos + 1;
            textEls[i].innerHTML = (intDay);
            d.setDate(d.getDate()+1);
            cells[i].className = 'x-date-active';
            setCellClass(<b>this</b>, cells[i]);
        }
        <b>var</b> extraDays = 0;
        <b>for</b>(; i &lt; 42; i++) {
             textEls[i].innerHTML = (++extraDays);
             d.setDate(d.getDate()+1);
             cells[i].className = 'x-date-nextday';
             setCellClass(<b>this</b>, cells[i]);
        }

        <b>this</b>.mbtn.setText(<b>this</b>.monthNames[date.getMonth()] + ' ' + date.getFullYear());

        <b>if</b>(!<b>this</b>.rendered){
            <b>var</b> main = <b>this</b>.el.dom.firstChild;
            <b>var</b> w = main.offsetWidth;
            <b>this</b>.el.setWidth(w + <b>this</b>.el.getBorderWidth('lr'));
            Ext.fly(main).setWidth(w);

            <i>// opera does not respect the auto grow header center column</i>
            <i>// then, after it gets a width opera refuses to recalculate</i>
            <i>// without a second pass</i>
            <b>if</b>(Ext.isOpera &amp;&amp; !<b>this</b>.secondPass){
                main.rows[0].cells[1].style.width = (w - (main.rows[0].cells[0].offsetWidth+main.rows[0].cells[2].offsetWidth)) + 'px';
                <b>this</b>.secondPass = true;
                <b>this</b>.update.defer(10, <b>this</b>, [date]);
            }
        }
    },

    todayText : &quot;Today&quot;,
    todayTip : &quot;{0} (Spacebar)&quot;,
    minDate : null,
    maxDate : null,
    minText : &quot;This date is before the minimum date&quot;,
    maxText : &quot;This date is after the maximum date&quot;,
    format : 'm/d/y',
    disabledDays : null,
    disabledDaysText : '',
    disabledDatesRE : null,
    disabledDatesText : '',
    constrainToViewport : true,
    monthNames : Date.monthNames,
    dayNames : Date.dayNames,
    nextText: 'Next Month (Control+Right)',
    prevText: 'Previous Month (Control+Left)',
    monthYearText: 'Choose a month (Control+Up/Down to move years)'
});</code></pre><hr><div style="font-size:10px;text-align:center;color:gray;">yui-ext - Copyright &copy; 2006 Jack Slocum.  |
    Yahoo! UI - Copyright &copy; 2006 Yahoo! Inc.<br />All rights reserved.</div>
    </body></html>