<html><head><title>EditorGrid.js</title><link rel="stylesheet" type="text/css" href="../resources/style.css" media="screen"/></head><body><h1>EditorGrid.js</h1><pre class="highlighted"><code><i>/**
 * @class Ext.grid.EditorGrid
 * @extends Ext.grid.Grid
 * Shortcut class <b>for</b> creating and editable grid.
 * @param {String/HTMLElement/Ext.Element} container The element into which <b>this</b> grid will be rendered - 
 * The container MUST have some type of size defined <b>for</b> the grid to fill. The container will be 
 * automatically set to position relative <b>if</b> it isn't already.
 * @param {Object} dataSource The data model to bind to
 * @param {Object} colModel The column model <b>with</b> info about <b>this</b> grid's columns
 */</i>
Ext.grid.EditorGrid = <b>function</b>(container, config){
    Ext.grid.EditorGrid.superclass.constructor.call(<b>this</b>, container, config);
    <b>this</b>.container.addClass('xedit-grid');

    <b>if</b>(!<b>this</b>.selModel){
        <b>this</b>.selModel = <b>new</b> Ext.grid.CellSelectionModel();
    }

    <b>this</b>.activeEditor = null;

	Ext.apply(<b>this</b>.events, {
	    <i>/**
	     * @event beforeedit
	     * Fires before a cell is edited
	     * @param {Grid} <b>this</b>
	     * @param {Number} rowIndex
	     * @param {Number} columnIndex
	     */</i>
	    'beforeedit' : true,
	    <i>/**
	     * @event afteredit
	     * Fires after a cell is edited
	     * @param {Grid} <b>this</b>
	     * @param {Number} rowIndex
	     * @param {Number} columnIndex
	     */</i>
	    'afteredit' : true
	});
    <b>this</b>.on('bodyscroll', <b>this</b>.stopEditing,  <b>this</b>);
    <b>this</b>.on(<b>this</b>.clicksToEdit == 1 ? 'cellclick' : 'celldblclick', <b>this</b>.onCellDblClick,  <b>this</b>);
};

Ext.extend(Ext.grid.EditorGrid, Ext.grid.Grid, {
    isEditor : true,
    clicksToEdit: 2,
    
    onCellDblClick : <b>function</b>(g, row, col){
        <b>this</b>.startEditing(row, col);
    },

    onEditComplete : <b>function</b>(ed, value, startValue){
        <b>this</b>.editing = false;
        ed.un('specialkey', <b>this</b>.onEditorKey, <b>this</b>);
        <b>if</b>(value != startValue){
            <b>var</b> r = <b>this</b>.dataSource.getAt(ed.row);
            <b>var</b> field = <b>this</b>.colModel.getDataIndex(ed.col);
            <b>if</b>(this.fireEvent('afteredit', <b>this</b>, r, field, ed.row, ed.col) !== false){
                r.set(field, value);
            }
        }
        <b>this</b>.view.focusCell(ed.row, ed.col);
    },

    <i>/**
     * Starts editing the specified <b>for</b> the specified row/column
     * @param {Number} rowIndex
     * @param {Number} colIndex
     */</i>
    startEditing : <b>function</b>(row, col, buf){
        <b>this</b>.stopEditing();
        <b>if</b>(this.colModel.isCellEditable(col, row)){
            <b>this</b>.view.focusCell(row, col);
            <b>var</b> r = <b>this</b>.dataSource.getAt(row);
            <b>var</b> field = <b>this</b>.colModel.getDataIndex(col);
            <b>if</b>(this.fireEvent('beforeedit', <b>this</b>, r, field, row, col) !== false){
                <b>this</b>.editing = true; <i>// flag <b>for</b> buffering of orphan key strokes</i>
                (<b>function</b>(){ <i>// complex but required <b>for</b> focus issues <b>in</b> safari, ie and opera</i>
                    <b>var</b> ed = <b>this</b>.colModel.getCellEditor(col, row);
                    ed.row = row; ed.col = col;
                    ed.on('complete', <b>this</b>.onEditComplete, <b>this</b>, {single: true});
                    ed.on('specialkey', <b>this</b>.selModel.onEditorKey, <b>this</b>.selModel);
                    <b>this</b>.activeEditor = ed;
                    <b>var</b> v;
                    <b>if</b>(buf){
                        v = buf.join('');
                        buf.splice(0, buf.length);
                    }<b>else</b>{
                        v = r.data[field];
                    }
                    ed.startEdit(<b>this</b>.view.getCell(row, col), v);
                }).defer(50, <b>this</b>);
            }
        }
    },
        
    <i>/**
     * Stops any active editing
     */</i>
    stopEditing : <b>function</b>(){
        <b>if</b>(this.activeEditor){
            <b>this</b>.activeEditor.completeEdit();
        }
        <b>this</b>.activeEditor = null;
    }
});</code></pre><hr><div style="font-size:10px;text-align:center;color:gray;">yui-ext - Copyright &copy; 2006 Jack Slocum.  |
    Yahoo! UI - Copyright &copy; 2006 Yahoo! Inc.<br />All rights reserved.</div>
    </body></html>