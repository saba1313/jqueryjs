<html><head><title>Layer.js</title><link rel="stylesheet" type="text/css" href="../resources/style.css" media="screen"/></head><body><h1>Layer.js</h1><pre class="highlighted"><code><i>/**
 * @class Ext.Layer
 * @extends Ext.Element
 * An extended Element object that supports a shadow and shim, constrain to viewport and
 * automatic maintaining of shadow/shim positions.
 * @cfg {Boolean} shim False to disable the iframe shim <b>in</b> browsers which need one (defaults to true)
 * @cfg {String/Boolean} shadow True to create a shadow element <b>with</b> default class &quot;x-layer-shadow&quot; or
 * you can pass a string <b>with</b> a css class name. False turns off the shadow.
 * @cfg {Object} dh DomHelper object config to create element <b>with</b> (defaults to {tag: 'div', cls: 'x-layer'}).
 * @cfg {Boolean} constrain False to disable constrain to viewport (defaults to true)
 * @cfg {String} cls CSS class to add to the element
 * @cfg {Number} zindex Starting z-index (defaults to 11000!)
 * @cfg {Number} shadowOffset Offset <b>for</b> the shadow (defaults to 3)
 * @constructor
 * @param {Object} config
 * @param {String/HTMLElement} existingEl (optional) Uses an existing dom element. If the element is not found it creates it.
 */</i>
(<b>function</b>(){ 
Ext.Layer = <b>function</b>(config, existingEl){
    config = config || {};
    <b>var</b> dh = Ext.DomHelper;
    <b>var</b> cp = config.parentEl, pel = cp ? (cp.dom || YAHOO.util.Dom.get(cp)) : document.body;
    <b>if</b>(existingEl){
        <b>this</b>.dom = existingEl.dom || YAHOO.util.Dom.get(existingEl);
    }
    <b>if</b>(!<b>this</b>.dom){
        <b>var</b> o = config.dh || {tag: 'div', cls: 'x-layer'};
        <b>this</b>.dom = dh.insertBefore(pel.firstChild, o);
    }
    <b>if</b>(config.cls){
        <b>this</b>.addClass(config.cls);
    }
    <b>this</b>.constrain = config.constrain !== false;
    <b>this</b>.visibilityMode = Ext.Element.VISIBILITY;
    <b>this</b>.id = YAHOO.util.Dom.generateId(<b>this</b>.dom);
    <b>var</b> zindex = (config.zindex || parseInt(<b>this</b>.getStyle('z-index'), 10)) || 11000;
    <b>this</b>.position('absolute', zindex);
    <b>if</b>(config.shadow){
        <b>this</b>.shadow = <b>new</b> Ext.Shadow({
            offset : config.shadowOffset || 4,
            mode : config.shadow
        });
    }<b>else</b>{
        <b>this</b>.shadowOffset = 0;
    }
    <b>if</b>(config.shim !== false &amp;&amp; Ext.useShims){
        <b>this</b>.shim = <b>this</b>.createShim();
        <b>this</b>.shim.setOpacity(0);
        <b>this</b>.shim.position('absolute', zindex-2);
    }
    <b>this</b>.useDisplay = config.useDisplay;
    <b>this</b>.hide();
};

<b>var</b> supr = Ext.Element.prototype;

Ext.extend(Ext.Layer, Ext.Element, {
    <i>// <b>this</b> code can execute repeatedly <b>in</b> milliseconds (i.e. during a drag) so</i>
    <i>// code size was sacrificed <b>for</b> effeciency (e.g. no getBox/setBox, no XY calls)</i>
    sync : <b>function</b>(doShow){
        <b>var</b> sw = <b>this</b>.shadow, sh = <b>this</b>.shim;
        <b>if</b>(this.isVisible() &amp;&amp; (sw || sh)){
            <b>var</b> w = <b>this</b>.getWidth(),
                h = <b>this</b>.getHeight();

            <b>var</b> l = <b>this</b>.getLeft(true),
                t = <b>this</b>.getTop(true);

            <b>if</b>(sw){
                <b>if</b>(doShow &amp;&amp; !sw.isVisible()){
                    sw.show(<b>this</b>);
                }<b>else</b>{
                    sw.realign(l, t, w, h);
                }
                <b>if</b>(sh){
                    <b>if</b>(doShow){
                       sh.show();
                    }
                    <i>// fit the shim behind the shadow, so it is shimmed too</i>
                    <b>var</b> a = sw.adjusts, s = sh.dom.style;
                    s.left = (l+a.l)+'px';
                    s.top = (t+a.t)+'px';
                    s.width = (w+a.w)+'px';
                    s.height = (h+a.h)+'px';
                }
            }<b>else</b> if(sh){
                <b>if</b>(doShow){
                   sh.show();
                }
                sh.setSize(w, h);
                sh.setLeftTop(l, t);
            }
            
        }
    },
    
    hideUnders : <b>function</b>(negOffset){
        <b>if</b>(this.shadow){
            <b>this</b>.shadow.hide();
        }
        <b>if</b>(this.shim){
           <b>this</b>.shim.hide();
           <b>if</b>(negOffset){
               <b>this</b>.shim.setLeftTop(-10000,-10000);
           }
        }
    },
    
    constrainXY : <b>function</b>(){
        <b>if</b>(this.constrain){
            <b>var</b> vw = YAHOO.util.Dom.getViewportWidth(),
                vh = YAHOO.util.Dom.getViewportHeight();
            <b>var</b> xy = <b>this</b>.getXY();
            <b>var</b> x = xy[0], y = xy[1];   
            <b>var</b> w = <b>this</b>.dom.offsetWidth+<b>this</b>.shadowOffset, h = <b>this</b>.dom.offsetHeight+<b>this</b>.shadowOffset;
            <i>// only move it <b>if</b> it needs it</i>
            <b>var</b> moved = false;
            <i>// first validate right/bottom</i>
            <b>if</b>(x + w &gt; vw){
                x = vw - w;
                moved = true;
            }
            <b>if</b>(y + h &gt; vh){
                y = vh - h;
                moved = true;
            }
            <i>// then make sure top/left isn't negative</i>
            <b>if</b>(x &lt; 0){
                x = 0;
                moved = true;
            }
            <b>if</b>(y &lt; 0){
                y = 0;
                moved = true;
            }
            <b>if</b>(moved){
                xy = [x, y];
                <b>this</b>.lastXY = xy;
                <b>this</b>.beforeAction();
                supr.setXY.call(<b>this</b>, xy);
                <b>this</b>.sync(true);
            }
        }
    },

    showAction : <b>function</b>(){
        <b>if</b>(this.useDisplay === true){
            <b>this</b>.setDisplayed('');
        }<b>else</b> if(<b>this</b>.lastXY){
            supr.setXY.call(<b>this</b>, <b>this</b>.lastXY);
        }
    },

    hideAction : <b>function</b>(){
        <b>if</b>(this.useDisplay === true){
            <b>this</b>.setDisplayed(false);
        }<b>else</b>{
            <b>this</b>.setLeftTop(-10000,-10000);
        }
    },

    setVisible : <b>function</b>(v, a, d, c, e){
        <b>this</b>.showAction();
        <b>if</b>(a &amp;&amp; v){
            <b>var</b> cb = <b>function</b>(){
                <b>this</b>.sync(true);
                <b>if</b>(c){
                    c();
                }
            }.createDelegate(<b>this</b>);
            supr.setVisible.call(<b>this</b>, true, true, d, cb, e);
        }<b>else</b>{
            <b>if</b>(!v){
                <b>this</b>.hideUnders(true);
            }
            <b>var</b> cb = c;
            <b>if</b>(a){
                cb = <b>function</b>(){
                    <b>this</b>.hideAction();
                    <b>if</b>(c){
                        c();
                    }
                }.createDelegate(<b>this</b>);
            }
            supr.setVisible.call(<b>this</b>, v, a, d, cb, e);
            <b>if</b>(v){
                <b>this</b>.sync(true);
            }<b>else</b> if(!a){
                <b>this</b>.hideAction();
            }
        }
    },

    beforeFx : <b>function</b>(){
        <b>this</b>.beforeAction();
        Ext.Layer.superclass.beforeFx.apply(<b>this</b>, arguments);
    },

    afterFx : <b>function</b>(){
        Ext.Layer.superclass.afterFx.apply(<b>this</b>, arguments);
        <b>this</b>.sync(<b>this</b>.isVisible());
    },

    beforeAction : <b>function</b>(){
        <b>if</b>(this.shadow){
            <b>this</b>.shadow.hide();
        }
    },
    
    setXY : <b>function</b>(xy, a, d, c, e){
        <b>this</b>.fixDisplay();
        <b>this</b>.lastXY = xy;
        <b>this</b>.beforeAction();
        <b>var</b> cb = <b>this</b>.createCB(c);
        supr.setXY.call(<b>this</b>, xy, a, d, cb, e);
        <b>if</b>(!a){
            cb();
        }
    },
    
    createCB : <b>function</b>(c){
        <b>var</b> el = <b>this</b>;
        <b>return</b> function(){
            el.constrainXY();
            el.sync(true);
            <b>if</b>(c){
                c();
            }
        };
    },
    
    setX : <b>function</b>(x, a, d, c, e){
        <b>this</b>.setXY([x, <b>this</b>.getY()], a, d, c, e);
    },
    
    setY : <b>function</b>(y, a, d, c, e){
        <b>this</b>.setXY([<b>this</b>.getX(), y], a, d, c, e);
    },
    
    setSize : <b>function</b>(w, h, a, d, c, e){
        <b>this</b>.beforeAction();
        <b>var</b> cb = <b>this</b>.createCB(c);
        supr.setSize.call(<b>this</b>, w, h, a, d, cb, e);
        <b>if</b>(!a){
            cb();
        }
    },
    
    setWidth : <b>function</b>(w, a, d, c, e){
        <b>this</b>.beforeAction();
        <b>var</b> cb = <b>this</b>.createCB(c);
        supr.setWidth.call(<b>this</b>, w, a, d, cb, e);
        <b>if</b>(!a){
            cb();
        }
    },
    
    setHeight : <b>function</b>(h, a, d, c, e){
        <b>this</b>.beforeAction();
        <b>var</b> cb = <b>this</b>.createCB(c);
        supr.setHeight.call(<b>this</b>, h, a, d, cb, e);
        <b>if</b>(!a){
            cb();
        }
    },
    
    setBounds : <b>function</b>(x, y, w, h, a, d, c, e){
        <b>this</b>.beforeAction();
        <b>var</b> cb = <b>this</b>.createCB(c);
        <b>if</b>(!a){
            supr.setXY.call(<b>this</b>, [x, y]);
            supr.setSize.call(<b>this</b>, w, h, a, d, cb, e);
            cb();
        }<b>else</b>{
            supr.setBounds.call(<b>this</b>, x, y, w, h, a, d, cb, e);
        }
        <b>return</b> this;
    },
    
    <i>/**
     * Set the z-index of <b>this</b> layer and adjusts shadow and shims z-index. The result zindex is zindex + 2.
     * @param {Number} zindex
     * @<b>return</b> {<b>this</b>}
     */</i>
    setZIndex : <b>function</b>(zindex){
        <b>this</b>.setStyle('z-index', zindex + 2);
        <b>if</b>(this.shadow){
            <b>this</b>.shadow.setZIndex(zindex + 1);
        }
        <b>if</b>(this.shim){
            <b>this</b>.shim.setStyle('z-index', zindex);
        }
    }
});
})();</code></pre><hr><div style="font-size:10px;text-align:center;color:gray;">yui-ext - Copyright &copy; 2006 Jack Slocum.  |
    Yahoo! UI - Copyright &copy; 2006 Yahoo! Inc.<br />All rights reserved.</div>
    </body></html>