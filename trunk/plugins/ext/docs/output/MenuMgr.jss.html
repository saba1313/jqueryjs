<html><head><title>MenuMgr.js</title><link rel="stylesheet" type="text/css" href="../resources/style.css" media="screen"/></head><body><h1>MenuMgr.js</h1><pre class="highlighted"><code>Ext.menu.MenuMgr = <b>function</b>(){
   <b>var</b> menus, active, groups = {};

   <i>// private - called when first menu is created</i>
   <b>function</b> init(){
       menus = {}, active = <b>new</b> Ext.util.MixedCollection();
       <b>var</b> d = Ext.get(document);
       d.on('mousedown', onMouseDown);
       d.addKeyListener(27, <b>function</b>(){
           <b>if</b>(active.length &gt; 0){
               hideAll();
           }
       });
   }

   <b>function</b> hideAll(){
       <b>var</b> c = active.clone();
       c.each(<b>function</b>(m){
           m.hide();
       });
   }

   <b>function</b> onHide(m){
       active.remove(m);
   }

   <b>function</b> onShow(m){
       <b>var</b> last = active.last();
       active.add(m);
       <b>if</b>(m.parentMenu){
          m.getEl().setZIndex(parseInt(m.parentMenu.getEl().getStyle('z-index'), 10) + 3);
          m.parentMenu.activeChild = m;
       }<b>else</b> if(last &amp;&amp; last.isVisible()){
          m.getEl().setZIndex(parseInt(last.getEl().getStyle('z-index'), 10) + 3);
       }
   }

   <b>function</b> onBeforeHide(m){
       <b>if</b>(m.activeChild){
           m.activeChild.hide();
       }
       <b>if</b>(m.autoHideTimer){
           clearTimeout(m.autoHideTimer);
           <b>delete</b> m.autoHideTimer;
       }
   }

   <b>function</b> onBeforeShow(m){
       <b>var</b> pm = m.parentMenu;
       <b>if</b>(!pm &amp;&amp; !m.allowOtherMenus){
           hideAll();
       }<b>else</b> if(pm &amp;&amp; pm.activeChild){
           pm.activeChild.hide();
       }
   }

   <b>function</b> onMouseDown(e){
       <b>if</b>(active.length &gt; 0 &amp;&amp; !e.getTarget('.x-menu')){
           hideAll();
       }
   }

   <b>function</b> onBeforeCheck(mi, state){
       <b>if</b>(state){
           <b>var</b> g = groups[mi.group];
           <b>for</b>(var i = 0, l = g.length; i &lt; l; i++){
               <b>if</b>(g[i] != mi){
                   g[i].setChecked(false);
               }
           }
       }
   }

   <b>return</b> {
       register : <b>function</b>(menu){
           <b>if</b>(!menus){
               init();
           }
           menus[menu.id] = menu;
           menu.on('beforehide', onBeforeHide);
           menu.on('hide', onHide);
           menu.on('beforeshow', onBeforeShow);
           menu.on('show', onShow);
           <b>var</b> g = menu.group;
           <b>if</b>(g &amp;&amp; menu.events['checkchange']){
               <b>if</b>(!groups[g]){
                   groups[g] = [];
               }
               groups[g].push(menu);
               menu.on('checkchange', onCheck);
           }
       },

       get : <b>function</b>(menu){
           <b>if</b>(typeof menu == 'string'){ <i>// menu id</i>
               <b>return</b> menus[menuId];
           }<b>else</b> if(menu.events){  <i>// menu instance</i>
               <b>return</b> menu;
           }<b>else</b>{ <i>// otherwise, must be a config</i>
               <b>return</b> new Ext.menu.Menu(menu);
           }
       },

       unregister : <b>function</b>(menu){
           <b>delete</b> menus[menu.id];
           menu.un('beforehide', onBeforeHide);
           menu.un('hide', onHide);
           menu.un('beforeshow', onBeforeShow);
           menu.un('show', onShow);
           <b>var</b> g = menu.group;
           <b>if</b>(g &amp;&amp; menu.events['checkchange']){
               groups[g].remove(menu);
               menu.un('checkchange', onCheck);
           }
       },

       registerCheckable : <b>function</b>(menuItem){
           <b>var</b> g = menuItem.group;
           <b>if</b>(g){
               <b>if</b>(!groups[g]){
                   groups[g] = [];
               }
               groups[g].push(menuItem);
               menuItem.on('beforecheckchange', onBeforeCheck);
           }
       },

       unregisterCheckable : <b>function</b>(menuItem){
           <b>var</b> g = menuItem.group;
           <b>if</b>(g){
               groups[g].remove(menuItem);
               menuItem.un('beforecheckchange', onBeforeCheck);
           }
       }
   };
}();
</code></pre><hr><div style="font-size:10px;text-align:center;color:gray;">yui-ext - Copyright &copy; 2006 Jack Slocum.  |
    Yahoo! UI - Copyright &copy; 2006 Yahoo! Inc.<br />All rights reserved.</div>
    </body></html>