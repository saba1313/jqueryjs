<html><head><title>TreeNodeUI.js</title><link rel="stylesheet" type="text/css" href="../resources/style.css" media="screen"/></head><body><h1>TreeNodeUI.js</h1><pre class="highlighted"><code><i>/**
 * The TreeNode UI implementation is separate from the 
 * tree implementation. Unless you are customizing the tree UI,
 * you should never have to use <b>this</b> directly.
 */</i>
Ext.tree.TreeNodeUI = <b>function</b>(node){
    <b>this</b>.node = node;
    <b>this</b>.rendered = false;
    <b>this</b>.animating = false;
    <b>this</b>.emptyIcon = Ext.BLANK_IMAGE_URL;
};

Ext.tree.TreeNodeUI.prototype = {
    removeChild : <b>function</b>(node){
        <b>if</b>(this.rendered){
            <b>this</b>.ctNode.removeChild(node.ui.getEl());
        } 
    },
    
    beforeLoad : <b>function</b>(){
         YAHOO.util.Dom.addClass(<b>this</b>.elNode, 'x-tree-node-loading');
    },
    
    afterLoad : <b>function</b>(){
         YAHOO.util.Dom.removeClass(<b>this</b>.elNode, 'x-tree-node-loading');
    },
    
    onTextChange : <b>function</b>(node, text, oldText){
        <b>if</b>(this.rendered){
            <b>this</b>.textNode.innerHTML = text;
        }
    },
    
    onDisableChange : <b>function</b>(node, state){
        <b>this</b>.disabled = state;
        <b>if</b>(state){
            YAHOO.util.Dom.addClass(<b>this</b>.elNode, 'x-tree-node-disabled');
        }<b>else</b>{
            YAHOO.util.Dom.removeClass(<b>this</b>.elNode, 'x-tree-node-disabled');
        } 
    },
    
    onSelectedChange : <b>function</b>(state){
        <b>if</b>(state){
            <b>this</b>.focus();
            YAHOO.util.Dom.addClass(<b>this</b>.elNode, 'x-tree-selected');
        }<b>else</b>{
            <b>this</b>.blur();
            YAHOO.util.Dom.removeClass(<b>this</b>.elNode, 'x-tree-selected');
        } 
    },
    
    onMove : <b>function</b>(tree, node, oldParent, newParent, index, refNode){
        <b>this</b>.childIndent = null;
        <b>if</b>(this.rendered){
            <b>var</b> targetNode = newParent.ui.getContainer();
            <b>if</b>(!targetNode){<i>//target not rendered</i>
                <b>this</b>.holder = document.createElement('div');
                <b>this</b>.holder.appendChild(<b>this</b>.wrap);
                <b>return</b>;
            }
            <b>var</b> insertBefore = refNode ? refNode.ui.getEl() : null;
            <b>if</b>(insertBefore){
                targetNode.insertBefore(<b>this</b>.wrap, insertBefore);
            }<b>else</b>{
                targetNode.appendChild(<b>this</b>.wrap);
            }
            <b>this</b>.node.renderIndent(true);
        }
    },
    
    remove : <b>function</b>(){
        <b>if</b>(this.rendered){
            <b>this</b>.holder = document.createElement('div');
            <b>this</b>.holder.appendChild(<b>this</b>.wrap);
        }  
    },
    
    fireEvent : <b>function</b>(){
        <b>return</b> this.node.fireEvent.apply(<b>this</b>.node, arguments);  
    },
    
    initEvents : <b>function</b>(){
        <b>this</b>.node.on('move', <b>this</b>.onMove, <b>this</b>);
        <i>//<b>this</b>.node.on('hiddenchange', <b>this</b>.onHiddenChange, <b>this</b>);</i>
        
        <i>// these were optimized out but a custom UI could use them</i>
        <i>//<b>this</b>.node.on('remove', <b>this</b>.onChildRemoved, <b>this</b>);</i>
        <i>//<b>this</b>.node.on('selectedstatechange', <b>this</b>.onSelectedChange, <b>this</b>);</i>
        <i>//<b>this</b>.node.on('disabledchange', <b>this</b>.onDisableChange, <b>this</b>);</i>
        <i>//<b>this</b>.node.on('textchange', <b>this</b>.onTextChange, <b>this</b>);</i>
        
        <b>var</b> E = YAHOO.util.Event;
        <b>var</b> a = <b>this</b>.anchor;
        
        <b>var</b> el = Ext.Element.fly(a);
        
        <b>if</b>(Ext.isOpera){ <i>// opera render bug ignores the CSS</i>
            el.setStyle('text-decoration', 'none');
        }
        
        el.on('click', <b>this</b>.onClick, <b>this</b>);
        el.on('dblclick', <b>this</b>.onDblClick, <b>this</b>);
        el.on('contextmenu', <b>this</b>.onContextMenu, <b>this</b>);
        
        <b>var</b> icon = Ext.Element.fly(<b>this</b>.iconNode);
        icon.on('click', <b>this</b>.onClick, <b>this</b>);
        icon.on('dblclick', <b>this</b>.onDblClick, <b>this</b>);
        icon.on('contextmenu', <b>this</b>.onContextMenu, <b>this</b>);
        E.on(<b>this</b>.ecNode, 'click', <b>this</b>.ecClick, <b>this</b>, true);
        
        <b>if</b>(this.node.disabled){
            YAHOO.util.Dom.addClass(<b>this</b>.elNode, 'x-tree-node-disabled');
        }
        <b>if</b>(this.node.hidden){
            YAHOO.util.Dom.addClass(<b>this</b>.elNode, 'x-tree-node-disabled');
        }
        <b>var</b> ot = <b>this</b>.node.getOwnerTree();
        <b>var</b> dd = ot.enableDD || ot.enableDrag || ot.enableDrop;
        <b>if</b>(dd &amp;&amp; (!<b>this</b>.node.isRoot || ot.rootVisible)){
            Ext.dd.Registry.register(<b>this</b>.elNode, {
                node: <b>this</b>.node,
                handles: [<b>this</b>.iconNode, <b>this</b>.textNode],
                isHandle: false
            });
        }
    },
    
    hide : <b>function</b>(){
        <b>if</b>(this.rendered){
            <b>this</b>.wrap.style.display = 'none';
        }  
    },
    
    show : <b>function</b>(){
        <b>if</b>(this.rendered){
            <b>this</b>.wrap.style.display = '';
        } 
    },
    
    onContextMenu : <b>function</b>(e){
        e.preventDefault();
        <b>this</b>.focus();
        <b>this</b>.fireEvent('contextmenu', <b>this</b>.node, e);
    },
    
    onClick : <b>function</b>(e){
        <b>if</b>(this.dropping){
            <b>return</b>;
        }
        <b>if</b>(this.fireEvent('beforeclick', <b>this</b>.node, e) !== false){
            <b>if</b>(!<b>this</b>.disabled &amp;&amp; <b>this</b>.node.attributes.href){
                <b>this</b>.fireEvent('click', <b>this</b>.node, e);
                <b>return</b>;
            }
            e.preventDefault();
            <b>if</b>(this.disabled){
                <b>return</b>;
            }
            <b>this</b>.fireEvent('click', <b>this</b>.node, e);
        }<b>else</b>{
            e.stopEvent();
        }
    },
    
    onDblClick : <b>function</b>(e){
        e.preventDefault();
        <b>if</b>(this.disabled){
            <b>return</b>;
        }
        <b>if</b>(!<b>this</b>.animating &amp;&amp; <b>this</b>.node.hasChildNodes()){
            <b>this</b>.node.toggle();
        }
        <b>this</b>.fireEvent('dblclick', <b>this</b>.node, e);
    },
    
    ecClick : <b>function</b>(e){
        <b>if</b>(!<b>this</b>.animating &amp;&amp; <b>this</b>.node.hasChildNodes()){
            <b>this</b>.node.toggle();
        }
    },
    
    startDrop : <b>function</b>(){
        <b>this</b>.dropping = true;
    },
    
    <i>// delayed drop so the click event doesn't get fired on a drop</i>
    endDrop : <b>function</b>(){ 
       setTimeout(<b>function</b>(){
           <b>this</b>.dropping = false;
       }.createDelegate(<b>this</b>), 50); 
    },
    
    expand : <b>function</b>(){
        <b>this</b>.updateExpandIcon();
        <b>this</b>.ctNode.style.display = '';
    },
    
    focus : <b>function</b>(){
        try{
            <b>this</b>.anchor.focus();
        }catch(e){} 
    },
    
    blur : <b>function</b>(){
        try{
            <b>this</b>.anchor.blur();
        }catch(e){} 
    },
    
    animExpand : <b>function</b>(callback){
        <b>if</b>(this.animating &amp;&amp; <b>this</b>.anim){
            <b>this</b>.anim.stop();
        }
        <b>if</b>(!<b>this</b>.node.hasChildNodes()){
            <b>this</b>.updateExpandIcon();
            <b>this</b>.ctNode.style.display = '';
            <b>if</b>(typeof callback == '<b>function</b>'){
                callback();
            }
            <b>return</b>;
        }
        <b>this</b>.animating = true;
        <b>this</b>.updateExpandIcon();
        <b>var</b> ct = <b>this</b>.ctNode;
        <b>var</b> cs = ct.style;
        cs.position = 'absolute';
        cs.visibility = 'hidden';
        cs.display = '';
        <b>var</b> h = ct.clientHeight;
        cs.overflow = 'hidden';
        cs.height = '1px';
        cs.position = '';
        cs.visibility = '';
        <b>var</b> anim = <b>new</b> YAHOO.util.Anim(ct, {
            height: {to: h}
        }, <b>this</b>.node.ownerTree.duration || .25, YAHOO.util.Easing.easeOut);
        anim.onComplete.subscribe(<b>function</b>(){
            cs.overflow = '';
            cs.height = '';
            <b>this</b>.animating = false;
            <b>this</b>.anim = null;
            <b>if</b>(typeof callback == '<b>function</b>'){
                callback();
            }
        }, <b>this</b>);
        <b>this</b>.anim = anim;
        anim.animate();
    },
    
    highlight : <b>function</b>(){
        <b>var</b> tree = <b>this</b>.node.getOwnerTree();
        <b>var</b> hlColor = tree.hlColor || 'C3DAF9';
        <b>var</b> hlBaseColor = tree.hlBaseColor || 'FFFFFF';
        <b>var</b> anim = <b>new</b> YAHOO.util.ColorAnim(<b>this</b>.wrap, {
            backgroundColor: {from: hlColor, to: hlBaseColor}
        }, .75, YAHOO.util.Easing.easeNone);
        anim.onComplete.subscribe(<b>function</b>(){
            YAHOO.util.Dom.setStyle(<b>this</b>.wrap, 'background-color', '');
        }, <b>this</b>);
        anim.animate(); 
    },
    
    collapse : <b>function</b>(){
        <b>this</b>.updateExpandIcon();
        <b>this</b>.ctNode.style.display = 'none';
    },
    
    animCollapse : <b>function</b>(callback){
        <b>if</b>(this.animating &amp;&amp; <b>this</b>.anim){
            <b>this</b>.anim.stop();
        }
        <b>this</b>.animating = true;
        <b>this</b>.updateExpandIcon();
        <b>var</b> ct = <b>this</b>.ctNode;
        <b>var</b> cs = ct.style;
        cs.height = ct.offsetHeight +'px';
        cs.overflow = 'hidden';
        <b>var</b> anim = <b>new</b> YAHOO.util.Anim(ct, {
            height: {to: 1}
        }, <b>this</b>.node.ownerTree.duration || .25, YAHOO.util.Easing.easeOut);
        anim.onComplete.subscribe(<b>function</b>(){
            cs.display = 'none';
            cs.overflow = '';
            cs.height = '';
            <b>this</b>.animating = false;
            <b>this</b>.anim = null;
            <b>if</b>(typeof callback == '<b>function</b>'){
                callback();
            }
        }, <b>this</b>);
        <b>this</b>.anim = anim;
        anim.animate();
    },
    
    getContainer : <b>function</b>(){
        <b>return</b> this.ctNode;  
    },
    
    getEl : <b>function</b>(){
        <b>return</b> this.wrap;  
    },
    
    appendDDGhost : <b>function</b>(ghostNode){
        ghostNode.appendChild(<b>this</b>.elNode.cloneNode(true));
    },
    
    getDDRepairXY : <b>function</b>(){
        <b>return</b> YAHOO.util.Dom.getXY(<b>this</b>.iconNode);  
    },
    
    onRender : <b>function</b>(){
        <b>this</b>.render();    
    },
    
    render : <b>function</b>(bulkRender){
        <b>var</b> n = <b>this</b>.node;
        <b>var</b> targetNode = n.parentNode ? 
              n.parentNode.ui.getContainer() : n.ownerTree.container.dom;
        <b>if</b>(!<b>this</b>.rendered){
            <b>this</b>.rendered = true;
            <b>var</b> a = n.attributes;
        
            <i>// add some indent caching, <b>this</b> helps performance when rendering a large tree</i>
            <b>this</b>.indentMarkup = '';
            <b>if</b>(n.parentNode){
                <b>this</b>.indentMarkup = n.parentNode.ui.getChildIndent();
            }
            
            <b>var</b> buf = ['&lt;li class=&quot;x-tree-node&quot;&gt;&lt;div class=&quot;x-tree-node-el ', n.attributes.cls,'&quot;&gt;',
                '&lt;span class=&quot;x-tree-node-indent&quot;&gt;',<b>this</b>.indentMarkup,'&lt;/span&gt;',
                '&lt;img src=&quot;', <b>this</b>.emptyIcon, '&quot; class=&quot;x-tree-ec-icon&quot;&gt;',
                '&lt;img src=&quot;', a.icon || <b>this</b>.emptyIcon, '&quot; class=&quot;x-tree-node-icon',(a.icon ? ' x-tree-node-inline-icon' : ''),'&quot; unselectable=&quot;on&quot;&gt;',
                '&lt;a href=&quot;',a.href ? a.href : '#','&quot; tabIndex=&quot;1&quot; ',
                 a.hrefTarget ? ' target=&quot;'+a.hrefTarget+'&quot;' : '','&gt;&lt;span unselectable=&quot;on&quot;&gt;',n.text,'&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;',
                '&lt;ul class=&quot;x-tree-node-ct&quot; style=&quot;display:none;&quot;&gt;&lt;/ul&gt;',
                '&lt;/li&gt;'];
                
            <b>if</b>(bulkRender !== true &amp;&amp; n.nextSibling &amp;&amp; n.nextSibling.ui.getEl()){
                <b>this</b>.wrap = Ext.DomHelper.insertHtml('beforeBegin', 
                                    n.nextSibling.ui.getEl(), buf.join(''));
            }<b>else</b>{
                <b>this</b>.wrap = Ext.DomHelper.insertHtml('beforeEnd', targetNode, buf.join(''));
            }
            <b>this</b>.elNode = <b>this</b>.wrap.childNodes[0];
            <b>this</b>.ctNode = <b>this</b>.wrap.childNodes[1];
            <b>var</b> cs = <b>this</b>.elNode.childNodes;
            <b>this</b>.indentNode = cs[0];
            <b>this</b>.ecNode = cs[1];
            <b>this</b>.iconNode = cs[2];
            <b>this</b>.anchor = cs[3];
            <b>this</b>.textNode = cs[3].firstChild;
            <b>if</b>(a.qtip){
               <b>if</b>(this.textNode.setAttributeNS){
                   <b>this</b>.textNode.setAttributeNS('ext', 'qtip', a.qtip);
                   <b>if</b>(a.qtipTitle){
                       <b>this</b>.textNode.setAttributeNS('ext', 'qtitle', a.qtipTitle);
                   }
               }<b>else</b>{
                   <b>this</b>.textNode.setAttribute('ext:qtip', a.qtip);
                   <b>if</b>(a.qtipTitle){
                       <b>this</b>.textNode.setAttribute('ext:qtitle', a.qtipTitle);
                   }
               } 
            }
            <b>this</b>.initEvents();
            <i>//<b>this</b>.renderIndent(); cached above now instead call updateExpandIcon</i>
            <b>this</b>.updateExpandIcon();
        }<b>else</b>{
            <b>if</b>(bulkRender === true) {
                targetNode.appendChild(<b>this</b>.wrap);
            }
        }
    },
    
    getAnchor : <b>function</b>(){
        <b>return</b> this.anchor;
    },
    
    getTextEl : <b>function</b>(){
        <b>return</b> this.textNode;
    },
    
    getIconEl : <b>function</b>(){
        <b>return</b> this.iconNode;
    },
    
    updateExpandIcon : <b>function</b>(){
        <b>if</b>(this.rendered){
            <b>var</b> n = <b>this</b>.node;
            <b>var</b> cls = n.isLast() ? &quot;x-tree-elbow-end&quot; : &quot;x-tree-elbow&quot;;
            <b>var</b> hasChild = n.hasChildNodes();
            <b>if</b>(hasChild){
                cls += n.expanded ? '-minus' : '-plus';
                <b>var</b> c1 = n.expanded ? 'x-tree-node-collapsed' : 'x-tree-node-expanded';
                <b>var</b> c2 = n.expanded ? 'x-tree-node-expanded' : 'x-tree-node-collapsed';
                YAHOO.util.Dom.removeClass(<b>this</b>.elNode, 'x-tree-node-leaf');
                YAHOO.util.Dom.replaceClass(<b>this</b>.elNode, c1, c2);
            }<b>else</b>{
                YAHOO.util.Dom.replaceClass(<b>this</b>.elNode, 'x-tree-node-expanded', 'x-tree-node-leaf');
            }
            <b>this</b>.ecNode.className = 'x-tree-ec-icon '+cls;
        }
    },
    
    getChildIndent : <b>function</b>(){
        <b>if</b>(!<b>this</b>.childIndent){
            <b>var</b> buf = [];
            <b>var</b> p = <b>this</b>.node;
            <b>while</b>(p){
                <b>if</b>(!p.isRoot || (p.isRoot &amp;&amp; p.ownerTree.rootVisible)){
                    <b>if</b>(!p.isLast()) {
                        buf.unshift('&lt;img src=&quot;'+<b>this</b>.emptyIcon+'&quot; class=&quot;x-tree-elbow-line&quot;&gt;');
                    } <b>else</b> {
                        buf.unshift('&lt;img src=&quot;'+<b>this</b>.emptyIcon+'&quot; class=&quot;x-tree-icon&quot;&gt;');
                    }
                }
                p = p.parentNode;
            }
            <b>this</b>.childIndent = buf.join('');
        }
        <b>return</b> this.childIndent;
    },
    
    renderIndent : <b>function</b>(){
        <b>if</b>(this.rendered){
            <b>var</b> indent = '';
            <b>var</b> p = <b>this</b>.node.parentNode;
            <b>if</b>(p){
                indent = p.ui.getChildIndent();
            }
            <b>if</b>(this.indentMarkup != indent){ <i>// don't rerender <b>if</b> not required</i>
                <b>this</b>.indentNode.innerHTML = indent;
                <b>this</b>.indentMarkup = indent;
            }
            <b>this</b>.updateExpandIcon();
        }
    }
};

Ext.tree.RootTreeNodeUI = <b>function</b>(){
    Ext.tree.RootTreeNodeUI.superclass.constructor.apply(<b>this</b>, arguments);
};
Ext.extend(Ext.tree.RootTreeNodeUI, Ext.tree.TreeNodeUI);
Ext.tree.RootTreeNodeUI.prototype.render = <b>function</b>(){
    <b>if</b>(!<b>this</b>.rendered){
        <b>var</b> targetNode = <b>this</b>.node.ownerTree.container.dom;
        <b>this</b>.node.expanded = true;
        targetNode.innerHTML = '&lt;div class=&quot;x-tree-root-node&quot;&gt;&lt;/div&gt;';
        <b>this</b>.wrap = <b>this</b>.ctNode = targetNode.firstChild;
    }
};
Ext.tree.RootTreeNodeUI.prototype.collapse = <b>function</b>(){
};</code></pre><hr><div style="font-size:10px;text-align:center;color:gray;">yui-ext - Copyright &copy; 2006 Jack Slocum.  |
    Yahoo! UI - Copyright &copy; 2006 Yahoo! Inc.<br />All rights reserved.</div>
    </body></html>