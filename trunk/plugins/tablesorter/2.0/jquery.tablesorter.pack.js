/*
 *
 * TableSorter 2.0 - Client-side table sorting with ease!
 *
 * Copyright (c) 2007 Christian Bach (http://lovepeacenukes.com)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * jQueryDate: 
 * jQueryAuthor: Christian jQuery
 *
 */
(function($){$.extend({tablesorter:new function(){this.defaults={css:{header:'header',orderAsc:'headerSortUp',orderDesc:'headerSortDown'},sorting:{initialOrder:'asc',multisortKey:'shiftKey',filters:['zebra']},xpath:{findAllHeaders:'/thead:first/tr/th'},parsers:{},widgets:{},zebra:{css:['even','odd']},meta:true,headers:{},cancelSelection:true,debug:true};var k=[];var m=[];function benchmark(a,b){if(typeof console!="undefined"&&typeof console.debug!="undefined"){log(a+' '+(new Date().getTime()-b.getTime())+'ms')}else{}}function log(s){if(typeof console!="undefined"&&typeof console.debug!="undefined"){console.log(s)}else{alert(s)}}function buildParserCache(a,b){var c=[],cells=a.tBodies[0].rows[0].cells,l=cells.length;for(var i=0;i<l;i++){var p=false;if((b[i]&&b[i].sorter)){p=getParserById(b[i].sorter)}else if((a.config.headers[i]&&a.config.headers[i].sorter)){p=getParserById(a.config.headers[i].sorter)}if(!p){p=detectParserForColumn(cells[i])}c.push(p)}return c};function detectParserForColumn(a){var l=k.length;for(var i=1;i<l;i++){if(k[i].is(getElementText(a))){return k[i]}}return k[0]}function getParserById(a){var l=k.length;for(var i=0;i<l;i++){if(k[i].id.toLowerCase()==a.toLowerCase()){return k[i]}}return false}function buildCache(a){if(a.config.debug){var b=new Date()}var d=(a.tBodies[0]&&a.tBodies[0].rows.length)||0,totalCells=a.tBodies[0].rows[0].cells.length,k=a.config.parsers,cache={row:[],normalized:[]};for(var i=0;i<d;++i){var c=a.tBodies[0].rows[i],cols=[];cache.row.push(c);for(var j=0;j<totalCells;++j){cols.push(k[j].format(getElementText(c.cells[j])))}cols.push(i);cache.normalized.push(cols);cols=null};if(a.config.debug){benchmark('Building cache for '+d+' rows:',b)}return cache};function getElementText(a){return a.innerHTML};function appendToTable(a,b){if(a.config.debug){var d=new Date()}var c=b,r=c.row,n=c.normalized,totalRows=n.length,checkCell=(n[0].length-1),tableBody=$('tbody:first',a).empty();h="";for(var i=0;i<totalRows;++i){h+='<tr>'+r[n[i][checkCell]].innerHTML+'</tr>'}tableBody.html(h);h=null;applyWidget(a);if(a.config.debug){benchmark('Rebuilt table:',d)}};function buildHeaders(a){if(a.config.debug){var b=new Date()}var c=($.meta&&a.config.meta)?true:false,tableHeadersRows=[];for(var i=0;i<a.tHead.rows.length;i++){tableHeadersRows[i]=0};$tableHeaders=$(checkCellColSpan(a,tableHeadersRows,0,a.tHead.rows[0].cells.length));if(a.config.debug){benchmark('Built headers:',b)}return $tableHeaders};function checkCellColSpan(a,b,c,d){var e=[];var f=a.tHead.rows[c].cells;var g=0;d+=b[c];for(var i=b[c];i<d;i++){var h=f[i];if(h.colSpan>1){e=e.concat(checkCellColSpan(a,b,c+h.rowSpan,h.colSpan))}else{if(!checkHeaderMetadata(h)&&!checkHeaderOptions(a,i)){h.column=i;h.order=formatSortingOrder(a.config.sorting.initialOrder);if($.meta&&$(h).data().sorter){this.sorter=$(h).data().sorter}$(h).addClass(a.config.css.header);e.push(h)}b[c]=i+1}}return e};function checkHeaderMetadata(a){if(($.meta)&&($(a).data().sorter===false)){return true};return false}function checkHeaderOptions(a,i){if((a.config.headers[i])&&(a.config.headers[i].sorter===false)){return true};return false}function applyWidget(a){var c=a.config.widgets;var l=c.length;for(var i=0;i<l;i++){getWidgetById(c[i]).format(a)}}function getWidgetById(a){var l=m.length;for(var i=0;i<l;i++){if(m[i].id.toLowerCase()==a.toLowerCase()){return m[i]}}};function formatSortingOrder(v){if(typeof v!="Number"){i=(v.toLowerCase()=="desc")?1:0}else{i=(v==(0||1))?v:0}return i}function isValueInArray(v,a){var l=a.length;for(var i=0;i<l;i++){if(a[i][0]==v){return true}}return false}function setHeadersCss(b,c,d,e){c.removeClass(e[0]).removeClass(e[1]);var h=[];c.each(function(a){h[this.column]=$(this)});var l=d.length;for(var i=0;i<l;i++){h[d[i][0]].addClass(e[d[i][1]])}}function multisort(a,b,d){if(a.config.debug){var f=new Date()}var g,dynamicExp="sortWrapper = function(a,b) {",l=b.length;for(var i=0;i<l;i++){var c=b[i][0];var h=b[i][1];var s=(getCachedSortType(a.config.parsers,c)=='text')?((h==0)?'sortText':'sortTextDesc'):((h==0)?'sortNumeric':'sortNumericDesc');var e='e'+i;dynamicExp+='var '+e+' = '+s+'(a['+c+'],b['+c+']);';dynamicExp+='if('+e+') { return '+e+' }';dynamicExp+=' else {'}for(var i=0;i<l;i++){dynamicExp+='}'}dynamicExp+='return 0'dynamicExp+='};'eval(dynamicExp);d.normalized.sort(g);if(a.config.debug){benchmark('Sorting on '+b.length+' columns and dir '+h+' time:',f)}return d};function sortText(a,b){return((a<b)?-1:((a>b)?1:0))};function sortTextDesc(a,b){return((b<a)?-1:((b>a)?1:0))};function sortNumeric(a,b){return a-b};function sortNumericDesc(a,b){return b-a};function getCachedSortType(a,i){return a[i].type};this.construct=function(f){return this.each(function(){var b,$document,$headers,cache,config,shiftDown=0,sortOrder,sortList=[];this.config={};config=$.extend(this.config,$.tablesorter.defaults,f);b=$(this);$headers=buildHeaders(this);this.config.parsers=buildParserCache(this,$headers);cache=buildCache(this);var c=[config.css.orderAsc,config.css.orderDesc];applyWidget(this);$headers.click(function(e){var a=$(this);var i=this.column;var d=this.order%2;if(!e[config.sorting.multisortKey]){sortList=[];sortList.push([i,d])}else{if(isValueInArray(i,sortList)){for(var j=0;j<sortList.length;j++){if(sortList[j][0]==i){sortList[j][1]=d}}}else{sortList.push([i,d])}};if(sortList.length==1){}b.trigger("sorton",[sortList]);this.order++;return false}).mousedown(function(){if(config.cancelSelection){this.onselectstart=function(){return false};return false}});b.bind('update',function(){cache=buildCache(this)}).bind('sorton',function(e,a){setHeadersCss(this,$headers,a,c);appendToTable(this,multisort(this,a,cache))})})};this.addParser=function(b){var l=k.length,a=true;for(var i=0;i<l;i++){if(k[i].id.toLowerCase()==b.id.toLowerCase()){a=false}}if(a){k.push(b)}};this.addWidget=function(a){m.push(a)};this.formatFloat=function(s){var i=parseFloat(s);return(isNaN(i))?0:i};this.formatInt=function(s){var i=parseInt(s);return(isNaN(i))?0:i}}});$.fn.extend({tablesorter:$.tablesorter.construct});$.tablesorter.addParser({id:'text',is:function(s){return true},format:function(s){return $.trim(s.toLowerCase())},type:'text'});$.tablesorter.addParser({id:'integer',is:function(s){return s.match(new RegExp(/^\d+$/))},format:function(s){return $.tablesorter.formatInt(s)},type:'numeric'});$.tablesorter.addWidget({id:'zebra',format:function(a){$("> tbody:first/tr:visible:even",a).addClass(a.config.zebra.css[0]);$("> tbody:first/tr:visible:odd",a).addClass(a.config.zebra.css[1])}})})(jQuery);