<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">

<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>index</title>
	<meta name="author" content="Yehuda Katz">
	<script src="http://code.jquery.com/jquery-latest.pack.js"></script>
	<script>
	  window.onload = function() {
	    e = $.browser.msie ? document.frames["editor"].document : $("iframe#editor")[0].contentDocument;
	    e.designMode = "on";
	    try { e.execCommand('useCSS', false, false); } catch(ex) {}
	    try { e.execCommand('styleWithCSS', false, false); } catch(ex) {}	    
	    $("button.command").click(function() {
	      e.execCommand(this.name, false, false);
	    });
	    $("button.meta-command[@name=done]").click(function() {
	      alert(e.body.innerHTML);
	    });
	  };

    jQuery.fn.absNext = function(){
      var nextSib = this[0].nextSibling, ws = false;
      while(nextSib && nextSib.nodeType == 3 && nextSib.textContent.match(/^[\s\n]*$/)) {
        ws = true;
      }

      if(!nextSib || nextSib.nodeType == 3) return;
  		else return [ws, nextSib];
  	}
  	
  	jQuery.fn.collapseAdjacent = function() {
  	  return this
  	    .filter(function() {
  	      if(!this.tagName) return false;
    	    var next = $(this).absNext();
    	    if(next && next[1].tagName == this.tagName) {
    	      if(next[0]) $(this).append(" ");
    	      $(next[1].childNodes).appendTo(this);
    	      $(next[1]).remove();
    	      return this.parentNode;
  	      }
  	  });
  	}
	</script>
</head>
<body>
  <div>
    <button name="bold" class="command">Bold</button>
    <button name="italic" class="command">Italic</button>
    <button name="underline" class="command">Underline</button>
    <button name="done" class="meta-command">Done</button>
  </div>
  <iframe src="designmode.html" id="editor" designmode="on" />
</body>
</html>
